module.exports=[55477,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(30485);var e=a.i(31052),f=a.i(76650);a.i(69387);var g=a.i(60574);a.i(60121);var h=a.i(5420),i=a.i(10682),j=a.i(61094);a.s(["default",0,()=>{let{t:a}=(0,i.useStrings)(),k=(0,d.useRouter)(),l=(0,d.useParams)(),m=(0,e.getAuth)(f.app),n=l.id,o=l.noteId,[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)({}),[x,y]=(0,c.useState)(!0),[z,A]=(0,c.useState)(!1),B=async a=>{try{for(let b of(await (0,g.getDocs)((0,g.collection)(f.db,"organizations"))).docs)if((await (0,g.getDoc)((0,g.doc)(f.db,`organizations/${b.id}/users/${a}`))).exists())return b.id;return null}catch(a){return console.error("Error fetching user organization:",a),null}},C=async a=>{try{let b=await (0,g.getDoc)((0,g.doc)(f.db,`organizations/${a}/projects/${n}`));if(b.exists()){let a={id:b.id,...b.data()};s(a);let c=a.notes?.find(a=>a.id===o);c?u(c):(console.error("Note not found"),k.push(`/pages/projects/${n}`))}else console.error("Project not found"),k.push("/pages/projects")}catch(a){console.error("Error fetching project:",a)}},D=async a=>{try{let b=await (0,g.getDocs)((0,g.collection)(f.db,`organizations/${a}/users`)),c={};b.docs.forEach(a=>{c[a.id]=a.data().name||a.data().email}),w(c)}catch(a){console.error("Error fetching users:",a)}};(0,c.useEffect)(()=>{(async()=>{let a=m.currentUser;if(!a)return k.push("/auth/login");let b=await B(a.uid);b&&(q(b),await C(b),await D(b)),y(!1)})()},[n,o]);let E=(a,b=!0)=>{let c=Math.abs(a),d=Math.floor(c),e=Math.floor((c-d)*60),f=Math.round(((c-d)*60-e)*60);return`${d}\xb0${e}'${f}"${b?a>=0?"N":"S":a>=0?"E":"W"}`},F=async(a,b)=>{try{let c={id:Date.now().toString(),action:a,details:b,author:m.currentUser?.uid||"",authorName:v[m.currentUser?.uid]||m.currentUser?.email||"Unknown",timestamp:new Date().toISOString()},d=(0,g.doc)(f.db,`organizations/${p}/projects/${n}`);await (0,g.updateDoc)(d,{history:(0,g.arrayUnion)(c)})}catch(a){console.error("Error adding to history:",a)}},G=async a=>{if(a&&0!==a.length)try{for(let b of a)if(b.path){let a=(0,h.ref)(f.storage,b.path);try{await (0,h.deleteObject)(a)}catch(a){console.warn(`Could not delete file ${b.name}:`,a)}}}catch(a){console.error("Error deleting attachments:",a)}},H=async()=>{if(window.confirm(a("notes.confirmDelete"))){A(!0);try{t.attachments&&t.attachments.length>0&&await G(t.attachments);let a=(0,g.doc)(f.db,`organizations/${p}/projects/${n}`);await (0,g.updateDoc)(a,{notes:(0,g.arrayRemove)(t)}),await F("note_deleted",{noteTitle:t.title,noteId:o,deletedBy:m.currentUser?.uid,deletedByName:v[m.currentUser?.uid]||m.currentUser?.email,hadAttachments:(t.attachments?.length||0)>0,attachmentCount:t.attachments?.length||0,hadLocation:!!t.location,hadGeologicalLog:!!t.geologicalLog}),k.push(`/pages/projects/${n}`)}catch(b){console.error("Error deleting note:",b),alert(a("notes.deleteError")),A(!1)}}};return!x&&t&&r?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,b.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("button",{onClick:()=>k.push(`/pages/projects/${n}`),className:"text-blue-600 hover:text-blue-800 flex items-center gap-2 mb-3",children:[(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 17l-5-5m0 0l5-5m-5 5h12"})}),a("notes.backToProject")]}),(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-2",children:t.title}),(0,b.jsxs)("p",{className:"text-gray-600",children:[a("notes.project"),": ",r.title]})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:a("notes.description")}),(0,b.jsx)("div",{className:"prose max-w-none",children:(0,b.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.description||a("notes.noDescription")})})]}),t.attachments&&t.attachments.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["ðŸ“Ž ",a("notes.attachedFiles")," (",t.attachments.length,")"]}),(0,b.jsx)("div",{className:"space-y-3",children:t.attachments.map((c,d)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("span",{className:"text-3xl",children:c.type?.startsWith("image/")?"ðŸ–¼ï¸":c.type?.includes("pdf")?"ðŸ“„":c.name?.endsWith(".kml")||c.name?.endsWith(".gpx")?"ðŸ—ºï¸":"ðŸ“Ž"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-800",children:c.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[(c.size/1024/1024).toFixed(2)," ",a("notes.mb")]})]})]}),(0,b.jsx)("a",{href:c.url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:a("notes.openFile")})]},d))})]}),t.location&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["ðŸ“ ",a("notes.location")]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg text-gray-800",children:t.location.name}),t.location.latitude&&t.location.longitude&&(0,b.jsxs)("div",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[(0,b.jsxs)("p",{children:[(0,b.jsxs)("span",{className:"font-medium",children:[a("notes.decimalCoordinates"),":"]})," ",Number(t.location.latitude).toFixed(6),", ",Number(t.location.longitude).toFixed(6)]}),(0,b.jsxs)("p",{children:[(0,b.jsxs)("span",{className:"font-medium",children:[a("notes.dmsCoordinates"),":"]})," ",E(Number(t.location.latitude),!0),", ",E(Number(t.location.longitude),!1)]})]})]}),(0,b.jsx)("div",{className:"rounded-lg overflow-hidden border border-gray-200",children:(0,b.jsx)(j.default,{locations:[t.location],center:[Number(t.location.latitude),Number(t.location.longitude)],zoom:15,height:"400px",onMapClick:()=>{},onLocationClick:()=>{}})})]}),t.geologicalLog&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsxs)("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:["ðŸ—ºï¸ ",a("notes.geologicalLog")]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[t.geologicalLog.wellName&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:a("notes.well")}),(0,b.jsx)("p",{className:"font-medium",children:t.geologicalLog.wellName})]}),t.geologicalLog.location&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:a("notes.locationLabel")}),(0,b.jsx)("p",{className:"font-medium",children:t.geologicalLog.location})]}),t.geologicalLog.elevation&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:a("notes.elevation")}),(0,b.jsxs)("p",{className:"font-medium",children:[t.geologicalLog.elevation," ",a("notes.meters")]})]}),t.geologicalLog.totalDepth&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:a("notes.totalDepth")}),(0,b.jsxs)("p",{className:"font-medium",children:[t.geologicalLog.totalDepth," ",a("notes.meters")]})]})]}),t.geologicalLog.canvas&&(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50",children:(0,b.jsx)("img",{src:t.geologicalLog.canvas,alt:a("notes.geologicalLog"),className:"w-full h-auto"})}),t.geologicalLog.layers&&t.geologicalLog.layers.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-semibold mb-3",children:[a("notes.layers")," (",t.geologicalLog.layers.length,")"]}),(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:t.geologicalLog.layers.map((c,d)=>(0,b.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded border border-gray-300 shrink-0",style:{backgroundColor:c.color}}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:c.lithology}),(0,b.jsxs)("p",{className:"text-xs text-gray-600",children:[c.depthFrom,a("notes.depthFrom")," ",c.depthTo,a("notes.depthTo")]})]}),c.description&&(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:c.description}),c.grain_size&&(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[a("notes.grainSize"),": ",c.grain_size]}),c.fossils&&(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[a("notes.fossils"),": ",c.fossils]})]})]})},d))})]}),t.geologicalLog.canvas&&(0,b.jsxs)("button",{onClick:()=>{let a=document.createElement("a");a.href=t.geologicalLog.canvas,a.download=`geological_log_${t.geologicalLog.wellName||"export"}.png`,a.click()},className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:["ðŸ“¥ ",a("notes.downloadLog")]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:a("notes.information")}),(0,b.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500 mb-1",children:a("notes.author")}),(0,b.jsx)("p",{className:"font-medium text-gray-800",children:t.authorName})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500 mb-1",children:a("notes.createdAt")}),(0,b.jsx)("p",{className:"font-medium text-gray-800",children:(a=>{if(!a)return"";try{return new Date(a).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(b){return a}})(t.createdAt)})]}),t.location&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500 mb-1",children:a("notes.locationInfo")}),(0,b.jsxs)("p",{className:"font-medium text-gray-800 flex items-center gap-1",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),t.location.name]})]}),t.attachments&&t.attachments.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500 mb-1",children:a("files.attachments")}),(0,b.jsxs)("p",{className:"font-medium text-gray-800 flex items-center gap-1",children:["ðŸ“Ž ",t.attachments.length," ",a("notes.filesCount")]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:a("notes.actions")}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("button",{onClick:()=>k.push(`/pages/projects/${n}/notes/${o}/edit`),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),a("notes.edit")]}),(0,b.jsxs)("button",{onClick:H,disabled:z,className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),z?a("notes.deleting"):a("notes.delete")]})]})]})]})]})]})}):(0,b.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,b.jsxs)("div",{className:"text-xl",children:[a("loading"),"..."]})})}])}];

//# sourceMappingURL=app_pages_projects_%5Bid%5D_notes_%5BnoteId%5D_page_82a56816.js.map