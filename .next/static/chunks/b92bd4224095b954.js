(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97526,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566);e.i(51718);var o=e.i(18357),l=e.i(86632);e.i(36180);var r=e.i(98925);e.i(61086);var n=e.i(27215),i=e.i(35428),c=e.i(70254);e.s(["default",0,()=>{let{t:e}=(0,i.useStrings)(),d=(0,a.useRouter)(),m=(0,a.useParams)(),h=(0,o.getAuth)(l.app),g=m.id,x=m.noteId,[u,p]=(0,s.useState)(null),[j,b]=(0,s.useState)(null),[N,f]=(0,s.useState)(null),[y,v]=(0,s.useState)({}),[w,L]=(0,s.useState)(!0),[k,$]=(0,s.useState)(!1),C=async e=>{try{for(let t of(await (0,r.getDocs)((0,r.collection)(l.db,"organizations"))).docs)if((await (0,r.getDoc)((0,r.doc)(l.db,`organizations/${t.id}/users/${e}`))).exists())return t.id;return null}catch(e){return console.error("Error fetching user organization:",e),null}},z=async e=>{try{let t=await (0,r.getDoc)((0,r.doc)(l.db,`organizations/${e}/projects/${g}`));if(t.exists()){let e={id:t.id,...t.data()};b(e);let s=e.notes?.find(e=>e.id===x);s?f(s):(console.error("Note not found"),d.push(`/pages/projects/${g}`))}else console.error("Project not found"),d.push("/pages/projects")}catch(e){console.error("Error fetching project:",e)}},S=async e=>{try{let t=await (0,r.getDocs)((0,r.collection)(l.db,`organizations/${e}/users`)),s={};t.docs.forEach(e=>{s[e.id]=e.data().name||e.data().email}),v(s)}catch(e){console.error("Error fetching users:",e)}};(0,s.useEffect)(()=>{(async()=>{let e=h.currentUser;if(!e)return d.push("/auth/login");let t=await C(e.uid);t&&(p(t),await z(t),await S(t)),L(!1)})()},[g,x]);let D=(e,t=!0)=>{let s=Math.abs(e),a=Math.floor(s),o=Math.floor((s-a)*60),l=Math.round(((s-a)*60-o)*60);return`${a}\xb0${o}'${l}"${t?e>=0?"N":"S":e>=0?"E":"W"}`},U=async(e,t)=>{try{let s={id:Date.now().toString(),action:e,details:t,author:h.currentUser?.uid||"",authorName:y[h.currentUser?.uid]||h.currentUser?.email||"Unknown",timestamp:new Date().toISOString()},a=(0,r.doc)(l.db,`organizations/${u}/projects/${g}`);await (0,r.updateDoc)(a,{history:(0,r.arrayUnion)(s)})}catch(e){console.error("Error adding to history:",e)}},E=async e=>{if(e&&0!==e.length)try{for(let t of e)if(t.path){let e=(0,n.ref)(l.storage,t.path);try{await (0,n.deleteObject)(e)}catch(e){console.warn(`Could not delete file ${t.name}:`,e)}}}catch(e){console.error("Error deleting attachments:",e)}},M=async()=>{if(window.confirm(e("notes.confirmDelete"))){$(!0);try{N.attachments&&N.attachments.length>0&&await E(N.attachments);let e=(0,r.doc)(l.db,`organizations/${u}/projects/${g}`);await (0,r.updateDoc)(e,{notes:(0,r.arrayRemove)(N)}),await U("note_deleted",{noteTitle:N.title,noteId:x,deletedBy:h.currentUser?.uid,deletedByName:y[h.currentUser?.uid]||h.currentUser?.email,hadAttachments:(N.attachments?.length||0)>0,attachmentCount:N.attachments?.length||0,hadLocation:!!N.location,hadGeologicalLog:!!N.geologicalLog}),d.push(`/pages/projects/${g}`)}catch(t){console.error("Error deleting note:",t),alert(e("notes.deleteError")),$(!1)}}};return!w&&N&&j?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,t.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("button",{onClick:()=>d.push(`/pages/projects/${g}`),className:"text-blue-600 hover:text-blue-800 flex items-center gap-2 mb-3",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 17l-5-5m0 0l5-5m-5 5h12"})}),e("notes.backToProject")]}),(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:N.title}),(0,t.jsxs)("p",{className:"text-gray-600",children:[e("notes.project"),": ",j.title]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:e("notes.description")}),(0,t.jsx)("div",{className:"prose max-w-none",children:(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:N.description||e("notes.noDescription")})})]}),N.attachments&&N.attachments.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["ðŸ“Ž ",e("notes.attachedFiles")," (",N.attachments.length,")"]}),(0,t.jsx)("div",{className:"space-y-3",children:N.attachments.map((s,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("span",{className:"text-3xl",children:s.type?.startsWith("image/")?"ðŸ–¼ï¸":s.type?.includes("pdf")?"ðŸ“„":s.name?.endsWith(".kml")||s.name?.endsWith(".gpx")?"ðŸ—ºï¸":"ðŸ“Ž"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-gray-800",children:s.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[(s.size/1024/1024).toFixed(2)," ",e("notes.mb")]})]})]}),(0,t.jsx)("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:e("notes.openFile")})]},a))})]}),N.location&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["ðŸ“ ",e("notes.location")]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg text-gray-800",children:N.location.name}),N.location.latitude&&N.location.longitude&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[(0,t.jsxs)("p",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[e("notes.decimalCoordinates"),":"]})," ",Number(N.location.latitude).toFixed(6),", ",Number(N.location.longitude).toFixed(6)]}),(0,t.jsxs)("p",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[e("notes.dmsCoordinates"),":"]})," ",D(Number(N.location.latitude),!0),", ",D(Number(N.location.longitude),!1)]})]})]}),(0,t.jsx)("div",{className:"rounded-lg overflow-hidden border border-gray-200",children:(0,t.jsx)(c.default,{locations:[N.location],center:[Number(N.location.latitude),Number(N.location.longitude)],zoom:15,height:"400px",onMapClick:()=>{},onLocationClick:()=>{}})})]}),N.geologicalLog&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsxs)("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:["ðŸ—ºï¸ ",e("notes.geologicalLog")]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[N.geologicalLog.wellName&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:e("notes.well")}),(0,t.jsx)("p",{className:"font-medium",children:N.geologicalLog.wellName})]}),N.geologicalLog.location&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:e("notes.locationLabel")}),(0,t.jsx)("p",{className:"font-medium",children:N.geologicalLog.location})]}),N.geologicalLog.elevation&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:e("notes.elevation")}),(0,t.jsxs)("p",{className:"font-medium",children:[N.geologicalLog.elevation," ",e("notes.meters")]})]}),N.geologicalLog.totalDepth&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:e("notes.totalDepth")}),(0,t.jsxs)("p",{className:"font-medium",children:[N.geologicalLog.totalDepth," ",e("notes.meters")]})]})]}),N.geologicalLog.canvas&&(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50",children:(0,t.jsx)("img",{src:N.geologicalLog.canvas,alt:e("notes.geologicalLog"),className:"w-full h-auto"})}),N.geologicalLog.layers&&N.geologicalLog.layers.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-semibold mb-3",children:[e("notes.layers")," (",N.geologicalLog.layers.length,")"]}),(0,t.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.geologicalLog.layers.map((s,a)=>(0,t.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded border border-gray-300 shrink-0",style:{backgroundColor:s.color}}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("p",{className:"font-medium text-sm",children:s.lithology}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:[s.depthFrom,e("notes.depthFrom")," ",s.depthTo,e("notes.depthTo")]})]}),s.description&&(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:s.description}),s.grain_size&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e("notes.grainSize"),": ",s.grain_size]}),s.fossils&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e("notes.fossils"),": ",s.fossils]})]})]})},a))})]}),N.geologicalLog.canvas&&(0,t.jsxs)("button",{onClick:()=>{let e=document.createElement("a");e.href=N.geologicalLog.canvas,e.download=`geological_log_${N.geologicalLog.wellName||"export"}.png`,e.click()},className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:["ðŸ“¥ ",e("notes.downloadLog")]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:e("notes.information")}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-500 mb-1",children:e("notes.author")}),(0,t.jsx)("p",{className:"font-medium text-gray-800",children:N.authorName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-500 mb-1",children:e("notes.createdAt")}),(0,t.jsx)("p",{className:"font-medium text-gray-800",children:(e=>{if(!e)return"";try{let t={ru:"ru-RU",en:"en-US",uz:"uz-UZ"}[localStorage.getItem("language")||"ru"]||"ru-RU";return new Date(e).toLocaleDateString(t,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}})(N.createdAt)})]}),N.location&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-500 mb-1",children:e("notes.locationInfo")}),(0,t.jsxs)("p",{className:"font-medium text-gray-800 flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),N.location.name]})]}),N.attachments&&N.attachments.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-500 mb-1",children:e("files.attachments")}),(0,t.jsxs)("p",{className:"font-medium text-gray-800 flex items-center gap-1",children:["ðŸ“Ž ",N.attachments.length," ",e("notes.filesCount")]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:e("notes.actions")}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("button",{onClick:()=>d.push(`/pages/projects/${g}/notes/${x}/edit`),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e("notes.edit")]}),(0,t.jsxs)("button",{onClick:M,disabled:k,className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),k?e("notes.deleting"):e("notes.delete")]})]})]})]})]})]})}):(0,t.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,t.jsxs)("div",{className:"text-xl",children:[e("loading"),"..."]})})}])}]);