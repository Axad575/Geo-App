(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(n=0;n<c;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[h++]=255&t),1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],a=0,o=r-i;a<o;a+=16383)s.push(function(e,t,r){for(var i,s=[],a=t;a<r;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(r,i),l=a(s),u=l.write(r,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),o.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,n);var g=function(e){if(o.isBuffer(e)){var t=0|d(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(g)return g;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return A(e).length;default:if(i)return r?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=N[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,a=n,0===s&&a===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function p(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,l=Math.min(s,a),u=this.slice(r,i),h=e.slice(t,n),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return p(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return p(this,e,t,n,!1)};function w(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=n)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=c}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var g="",m=0;m<f;)g+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return g}function v(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function b(e,t,n,r,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function I(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function T(e,t,n,r,s){return t*=1,n>>>=0,s||I(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function E(e,t,n,r,s){return t*=1,n>>>=0,s||I(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[n+a]=l}return a}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,C(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=n,C(x(e),this,a,o);case"latin1":case"binary":return function(e,t,n,r){return C(x(t),e,n,r)}(this,e,t,n);case"base64":return l=t,u=n,C(A(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=n,C(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=1,a=0;for(this[t]=255&e;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=n-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,n){return T(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return T(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return E(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return E(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,r),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%l]}return this};var _=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function x(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function A(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(_,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,h=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=r;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),s-=u}return(f?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,g=r?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&o,f+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+f]=255&a,f+=g,a/=256,u-=8);e[n+f-g]|=128*m}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},a=!0;try{r[e](n,n.exports,s),a=!1}finally{a&&delete i[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},36180,98925,e=>{"use strict";var t,n,r,i,s,a,o,l,u,h,c,d,f,g,m=e.i(47167),p=e.i(67034),y=e.i(92953),w=e.i(8070),v=e.i(83877),b=e.i(97427),I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,T={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var r=function(){this.blockSize=-1};function i(){}function s(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^n&(i^s))+r[0]+0xd76aa478|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}i.prototype=r.prototype,e.F=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.D=function(e,t,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return r.prototype[t].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,r=this.C,i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=n;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var o,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new a([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return p(h(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new a(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function g(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function p(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new a(n,~e.h).add(d)}function y(e,t){return e.add(p(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(g(t))throw Error("division by zero");if(g(e))return new v(c,c);if(m(e))return t=b(p(e),t),new v(p(t.g),p(t.h));if(m(t))return t=b(e,p(t)),new v(p(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=I(n),r=I(r);var i=E(n,1),s=E(r,1);for(r=E(r,2),n=E(n,2);!g(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=E(r,1),n=E(n,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=h(n)).j(t);m(a)||a.l(e)>0;)n-=r,a=(s=h(n)).j(t);g(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function I(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new a(n,e.h)}function E(e,t){let n=t>>5;t%=32;let r=e.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new a(i,e.h)}(o=a.prototype).m=function(){if(m(this))return-p(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},o.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(g(this))return"0";if(m(this))return"-"+p(this).toString(e);let t=h(Math.pow(e,6));var n=this;let r="";for(;;){let i=b(n,t).g,s=(((n=y(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(g(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},o.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return m(e=y(this,e))?-1:+!g(e)},o.abs=function(){return m(this)?p(this):this},o.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new a(n,-0x80000000&n[n.length-1]?-1:0)},o.j=function(e){if(g(this)||g(e))return c;if(m(this))return m(e)?p(this).j(p(e)):p(p(this).j(e));if(m(e))return p(this.j(p(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),a=e.i(t)>>>16,o=65535&e.i(t);n[2*r+2*t]+=s*o,w(n,2*r+2*t),n[2*r+2*t+1]+=i*o,w(n,2*r+2*t+1),n[2*r+2*t+1]+=s*a,w(n,2*r+2*t+1),n[2*r+2*t+2]+=i*a,w(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new a(n,0)},o.B=function(e){return b(this,e).h},o.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new a(n,this.h&e.h)},o.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new a(n,this.h|e.h)},o.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new a(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,n=T.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=h(Math.pow(n,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),n);s<8?(s=h(Math.pow(n,s)),i=i.j(s).add(h(a))):i=(i=i.j(r)).add(h(a))}return i},t=T.Integer=a}).apply(void 0!==I?I:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,_={};(function(){var e,t,n=Object.defineProperty,c=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function d(e,t){if(t)e:{var r=c;e=e.split(".");for(var i=0;i<e.length-1;i++){var s=e[i];if(!(s in r))break e;r=r[s]}(t=t(i=r[e=e[e.length-1]]))!=i&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}d("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),d("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),d("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var f=f||{},g=this||self;function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function p(e,t,n){return e.call.apply(e.bind,arguments)}function y(e,t,n){return(y=p).apply(null,arguments)}function w(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var b="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function I(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function T(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new x,e=>e.reset());class x{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let A,C=!1,D=new class{constructor(){this.h=this.g=null}add(e,t){let n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{let e=Promise.resolve(void 0);A=()=>{e.then(k)}};function k(){let e;for(var t;e=null,D.g&&(e=D.g,D.g=D.g.next,D.g||(D.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){g.setTimeout(()=>{throw e},0)}(e)}S.j(t),S.h<100&&(S.h++,t.next=S.g,S.g=t)}C=!1}function R(){this.u=this.u,this.C=this.C}function M(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},M.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};g.addEventListener("test",e,t),g.removeEventListener("test",e,t)}catch(e){}return e}();function P(e){return/^[\s\xa0]*$/.test(e)}function L(e,t){M.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(L,M),L.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&L.Z.h.call(this)},L.prototype.h=function(){L.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),V=0;function U(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++V,this.da=this.fa=!1}function B(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function q(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function j(e){let t={};for(let n in e)t[n]=e[n];return t}let z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function G(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<z.length;t++)n=z[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function K(e){this.src=e,this.g={},this.h=0}function $(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(B(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Q(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}K.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=Q(e,t,r,i);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new U(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),W={};function J(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let a=m(i)?!!i.capture:!!i,o=ee(e);if(o||(e[H]=o=new K(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return Z.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)O||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function X(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[F])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ee(t))?($(n,e),0==n.h&&(n.src=null,t[H]=null)):B(e)}}}function Y(e){return e in W?W[e]:W[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new L(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&X(e),e=n.call(r,t)}return e}function ee(e){return(e=e[H])instanceof K?e:null}var et="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return"function"==typeof e?e:(e[et]||(e[et]=function(t){return e.handleEvent(t)}),e[et])}function er(){R.call(this),this.i=new K(this),this.M=this,this.G=null}function ei(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new M(t,e);else if(t instanceof M)t.target=t.target||e;else{var a=t;G(t=new M(s,e),a)}if(a=!0,i)for(r=i.length-1;r>=0;r--)a=es(n=t.g=i[r],s,!0,t)&&a;if(a=es(n=t.g=e,s,!0,t)&&a,a=es(n,s,!1,t)&&a,i)for(r=0;r<i.length;r++)a=es(n=t.g=i[r],s,!1,t)&&a}function es(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==n){let t=a.listener,n=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}v(er,R),er.prototype[F]=!0,er.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=m(i)?!!i.capture:!!i,r=en(r),t&&t[F])?(t=t.i,(a=String(n).toString())in t.g&&(r=Q(n=t.g[a],r,i,s))>-1&&(B(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[a],t.h--))):t&&(t=ee(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Q(n,r,i,s)),(r=t>-1?n[t]:null)&&X(r))}(this,e,t,n,r)},er.prototype.N=function(){if(er.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)B(n[e]);delete e.g[t],e.h--}}this.G=null},er.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},er.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ea extends R{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:g.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eo(e){R.call(this),this.h=e,this.g={}}v(eo,R);var el=[];function eu(e){q(e.g,function(e,t){this.g.hasOwnProperty(t)&&X(e)},e),e.g={}}eo.prototype.N=function(){eo.Z.N.call(this),eu(this)},eo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eh=g.JSON.stringify,ec=g.JSON.parse,ed=class{stringify(e){return g.JSON.stringify(e,void 0)}parse(e){return g.JSON.parse(e,void 0)}};function ef(){}function eg(){}var em={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){M.call(this,"d")}function ey(){M.call(this,"c")}v(ep,M),v(ey,M);var ew={},ev=null;function eb(){return ev=ev||new er}function eI(e){M.call(this,ew.Ia,e)}function eT(e){let t=eb();ei(t,new eI(t))}function eE(e,t){M.call(this,ew.STAT_EVENT,e),this.stat=t}function e_(e){let t=eb();ei(t,new eE(t,e))}function eS(e,t){M.call(this,ew.Ja,e),this.size=t}function ex(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){e()},t)}function eA(){this.g=!0}function eC(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return eh(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ew.Ia="serverreachability",v(eI,M),ew.STAT_EVENT="statevent",v(eE,M),ew.Ja="timingevent",v(eS,M),eA.prototype.ua=function(){this.g=!1},eA.prototype.info=function(){};var eD={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eN={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ek(){}function eR(e){return encodeURIComponent(String(e))}function eM(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new eo(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eO}function eO(){this.i=null,this.g="",this.h=!1}v(ek,ef),ek.prototype.g=function(){return new XMLHttpRequest},e=new ek;var eP={},eL={};function eF(e,t,n){e.M=1,e.A=e4(e2(t)),e.u=n,e.R=!0,eV(e,null)}function eV(e,t){e.F=Date.now(),eB(e),e.B=e2(e.A);var n,r,i,s,a,o,l=e.B,u=e.S;Array.isArray(u)||(u=[String(u)]),tc(l.i,"t",u),e.C=0,l=e.j.L,e.h=new eO,e.g=tX(e.j,l?t:null,!e.u),e.P>0&&(e.O=new ea(y(e.Y,e,e.g),e.P)),t=e.V,l=e.g,u=e.ba;var h="readystatechange";Array.isArray(h)||(h&&(el[0]=h.toString()),h=el);for(let e=0;e<h.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=en(r),t&&t[F]?t.K(n,r,m(i)?!!i.capture:!!i,s):J(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=en(r),t&&t[F]?t.J(n,r,m(i)?!!i.capture:!!i,s):J(t,n,r,!1,i,s)}(l,h[e],u||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eT(),n=e.i,r=e.v,i=e.B,s=e.l,a=e.S,o=e.u,n.info(function(){if(n.g)if(o){var e="",t=o.split("&");for(let n=0;n<t.length;n++){var l=t[n].split("=");if(l.length>1){let t=l[0];l=l[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+l+"&":e+(t+"=redacted&")}}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eU(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eB(e){e.T=Date.now()+e.H,eq(e,e.H)}function eq(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=ex(y(e.aa,e),t)}function ej(e){e.D&&(g.clearTimeout(e.D),e.D=null)}function ez(e){0==e.j.I||e.K||t$(e.j,e)}function eG(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eu(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eK(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eJ(n.h,e))){if(!e.L&&eJ(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tK(n),tP(n);else break e;tj(n),e_(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=ex(y(n.Va,n),6e3));1>=eW(n.h)&&n.ta&&(n.ta=void 0)}else tH(n,11)}else if((e.L||n.g==e)&&tK(n),!P(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=n.K))if(n.K=l,o=o[1],2==n.I)if("c"==o[0]){n.M=o[1],n.ba=o[2];let t=o[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=o[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eX(s,s.h),s.h=null))}if(r.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e8(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tJ(r,r.L?r.ba:null,r.W),e.L){eY(r.h,e);var a=r.O;a&&(e.H=a),e.D&&(ej(e),eB(e)),r.g=e}else tq(r);n.i.length>0&&tF(n)}else"stop"!=o[0]&&"close"!=o[0]||tH(n,7);else 3==n.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tH(n,7):tO(n):"noop"!=o[0]&&n.l&&n.l.qa(o),n.A=0)}}eT(4)}catch(e){}}eM.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tN(e)?t.j():this.Y(e)},eM.prototype.Y=function(e){try{if(e==this.g)e:{let d=tN(this.g),f=this.g.ya(),m=this.g.ca();if(!(d<3)&&(3!=d||this.g&&(this.h.h||this.g.la()||tk(this.g)))){this.K||4!=d||7==f||(8==f||m<=0?eT(3):eT(2)),ej(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eU(e))return e.g.la();let t=tk(e.g);if(""===t)return"";let n="",r=t.length,i=4==tN(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return eG(e),ez(e),"";e.h.i=new g.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,a=this.l,o=this.S,r.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+o+"]: "+i+"\n"+s+"\n"+d+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,a,o,l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(l)){var h=l;break t}}h=null}if(e=h)eC(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eK(this,e);else{this.o=!1,this.m=3,e_(12),eG(this),ez(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eL:isNaN(n=Number(t.substring(n,r)))?eP:(r+=1)+n>t.length?eL:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==eL){4==d&&(this.m=4,e_(14),e=!1),eC(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eP){this.m=4,e_(15),eC(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else eC(this.i,this.l,t,null),eK(this,t);if(eU(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=n.length||this.h.h||(this.m=1,e_(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.aa&&!c.P&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tz(c),c.P=!0,e_(11))}}else eC(this.i,this.l,n,"[Invalid Chunked Response]"),eG(this),ez(this)}else eC(this.i,this.l,n,null),eK(this,n);4==d&&eG(this),this.o&&!this.K&&(4==d?t$(this.j,this):(this.o=!1,eB(this)))}else(function(e){let t={};e=(e.g&&tN(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(P(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,e_(12)):(this.m=0,e_(13)),eG(this),ez(this)}}}catch(e){}finally{}},eM.prototype.cancel=function(){this.K=!0,eG(this)},eM.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eT(),e_(17)),eG(this),this.m=2,ez(this)):eq(this,this.T-n)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eQ(e){this.l=e||10,e=g.PerformanceNavigationTiming?(e=g.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eH(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eW(e){return e.h?1:e.g?e.g.size:0}function eJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eX(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eZ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return I(e.i)}eQ.prototype.cancel=function(){if(this.i=eZ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e1(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof e1?(this.l=e.l,e5(this,e.j),this.o=e.o,this.g=e.g,e6(this,e.u),this.h=e.h,e3(this,td(e.i)),this.m=e.m):e&&(t=String(e).match(e0))?(this.l=!1,e5(this,t[1]||"",!0),this.o=e7(t[2]||""),this.g=e7(t[3]||"",!0),e6(this,t[4]),this.h=e7(t[5]||"",!0),e3(this,t[6]||"",!0),this.m=e7(t[7]||"")):(this.l=!1,this.i=new ta(null,this.l))}function e2(e){return new e1(e)}function e5(e,t,n){e.j=n?e7(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e6(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e3(e,t,n){var r,i;t instanceof ta?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(to(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(tl(this,t),tc(this,n,e))},r)),r.j=i):(n||(t=e9(t,ti)),e.i=new ta(t,e.l))}function e8(e,t,n){e.i.set(t,n)}function e4(e){return e8(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e7(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e9(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,te),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function te(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e1.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e9(t,tt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e9(t,tt,!0),"@"),e.push(eR(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e9(n,"/"==n.charAt(0)?tr:tn,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e9(n,ts)),e.join("")},e1.prototype.resolve=function(e){let t=e2(this),n=!!e.j;n?e5(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e6(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e3(t,td(e.i)):n=!!e.m,n&&(t.m=e.m),t};var tt=/[#\/\?@]/g,tn=/[#\?:]/g,tr=/[#\?]/g,ti=/[#\?@]/g,ts=/#/g;function ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tl(e,t){to(e),t=tf(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tu(e,t){return to(e),t=tf(e,t),e.g.has(t)}function th(e,t){to(e);let n=[];if("string"==typeof t)tu(e,t)&&(n=n.concat(e.g.get(tf(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function tc(e,t,n){tl(e,t),n.length>0&&(e.i=null,e.g.set(tf(e,t),I(n)),e.h+=n.length)}function td(e){let t=new ta;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tf(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tg(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tm(){this.g=new ed}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){er.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tw(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tv(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tI(e){let t="";return q(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tT(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tI(n),"string"==typeof e?null!=n&&eR(n):e8(e,t,n))}function tE(e){er.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ta.prototype).add=function(e,t){to(this),this.i=null,e=tf(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){to(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return to(this),this.i=null,tu(this,e=tf(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=th(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eR(n);n=th(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eR(n[t])),e.push(r)}}return this.i=e.join("&")},v(tp,ef),tp.prototype.g=function(){return new ty(this.i,this.h)},v(ty,er),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||g).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tv(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==g.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tw(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tv(this):tb(this),3==this.readyState&&tw(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tv(this))},t.Na=function(e){this.g&&(this.response=e,tv(this))},t.ga=function(){this.g&&tv(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(tE,er);var t_=/^https?$/i,tS=["POST","PUT"];function tx(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tA(e),tD(e)}function tA(e){e.A||(e.A=!0,ei(e,"complete"),ei(e,"error"))}function tC(e){if(e.h&&void 0!==f){if(e.v&&4==tN(e))setTimeout(e.Ca.bind(e),0);else if(ei(e,"readystatechange"),4==tN(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(e0)[1]||null;!t&&g.self&&g.self.location&&(t=g.self.location.protocol.slice(0,-1)),n=!t_.test(t?t.toLowerCase():"")}t=n}if(t)ei(e,"complete"),ei(e,"success");else{e.o=6;try{var i=tN(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tA(e)}}finally{tD(e)}}}}function tD(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||ei(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tN(e){return e.g?e.g.readyState:0}function tk(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tM(e){this.za=0,this.i=[],this.j=new eA,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eQ(e&&e.concurrentRequestLimit),this.Ba=new tm,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tO(e){if(tL(e),3==e.I){var t=e.V++,n=e2(e.J);if(e8(n,"SID",e.M),e8(n,"RID",t),e8(n,"TYPE","terminate"),tU(e,n),(t=new eM(e,e.j,t)).M=2,t.A=e4(e2(n)),n=!1,g.navigator&&g.navigator.sendBeacon)try{n=g.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&g.Image&&((new Image).src=t.A,n=!0),n||(t.g=tX(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eB(t)}tW(e)}function tP(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tL(e){tP(e),e.v&&(g.clearTimeout(e.v),e.v=null),tK(e),e.h.cancel(),e.m&&("number"==typeof e.m&&g.clearTimeout(e.m),e.m=null)}function tF(e){if(!eH(e.h)&&!e.m){e.m=!0;var t=e.Ea;A||N(),C||(A(),C=!0),D.add(t,e),e.D=0}}function tV(e,t){var n;n=t?t.l:e.V++;let r=e2(e.J);e8(r,"SID",e.M),e8(r,"RID",n),e8(r,"AID",e.K),tU(e,r),e.u&&e.o&&tT(r,e.u,e.o),n=new eM(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tB(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eX(e.h,n),eF(n,r,t)}function tU(e,t){e.H&&q(e.H,function(e,n){e8(t,n,e)}),e.l&&q({},function(e,n){e8(t,n,e)})}function tB(e,t,n){n=Math.min(e.i.length,n);let r=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let l=0;l<n;l++){var s=i[l].g;let n=i[l].map;if((s-=t)<0)t=Math.max(0,i[l].g-100),o=!1;else try{s="req"+s+"_";try{var a=n instanceof Map?n:Object.entries(n);for(let[t,n]of a){let r=n;m(n)&&(r=eh(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(o){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,n),a}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;A||N(),C||(A(),C=!0),D.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=ex(y(e.Da,e),tQ(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(g.clearTimeout(e.B),e.B=null)}function tG(e){e.g=new eM(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e2(e.na);e8(t,"RID","rpc"),e8(t,"SID",e.M),e8(t,"AID",e.K),e8(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e8(t,"TO",e.ia),e8(t,"TYPE","xmlhttp"),tU(e,t),e.u&&e.o&&tT(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e4(e2(t)),n.u=null,n.R=!0,eV(n,e)}function tK(e){null!=e.C&&(g.clearTimeout(e.C),e.C=null)}function t$(e,t){var n,r=null;if(e.g==t){tK(e),tz(e),e.g=null;var i=2}else{if(!eJ(e.h,t))return;r=t.G,eY(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ei(i=eb(),new eS(i,r)),tF(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eW(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=ex(y(e.Ea,e,n),tQ(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tH(e,5);break;case 4:tH(e,10);break;case 3:tH(e,6);break;default:tH(e,2)}}}function tQ(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tH(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,r=y(e.bb,e),i=e.Ua;let o=!i;i=new e1(i||"//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||e5(i,"https"),e4(i),o?function(e,t){let n=new eA;if(g.Image){let r=new Image;r.onload=w(tg,n,"TestLoadImage: loaded",!0,t,r),r.onerror=w(tg,n,"TestLoadImage: error",!1,t,r),r.onabort=w(tg,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=w(tg,n,"TestLoadImage: timeout",!1,t,r),g.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eA,s=new AbortController,a=setTimeout(()=>{s.abort(),tg(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?tg(t,"TestPingServer: ok",!0,r):tg(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(a),tg(t,"TestPingServer: error",!1,r)}))}else e_(2);e.I=0,e.l&&e.l.pa(t),tW(e),tL(e)}function tW(e){if(e.I=0,e.ja=[],e.l){let t=eZ(e.h);(0!=t.length||0!=e.i.length)&&(T(e.ja,t),T(e.ja,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,n){var r=n instanceof e1?e2(n):new e1(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e6(r,r.u);else{var i=g.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new e1(null);r&&e5(e,r),t&&(e.g=t),i&&e6(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e8(r,n,t),e8(r,"VER",e.ka),tU(e,r),r}function tX(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tE(e.Aa&&!e.ma?new tp({ab:n}):e.ma)).Fa(e.L),t}function tY(){}function tZ(){}function t0(e,t){er.call(this),this.g=new tM(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!P(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!P(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t5(this)}function t1(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){ey.call(this),this.status=1}function t5(e){this.g=e}(t=tE.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tx(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=g.FormData&&t instanceof g.FormData,!(Array.prototype.indexOf.call(tS,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tx(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ei(this,"complete"),ei(this,"abort"),tD(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tD(this,!0)),tE.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tC(this):this.Xa())},t.Xa=function(){tC(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tN(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tM.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){e_(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tJ(this,null,this.W),tF(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eM(this,this.j,e),s=this.o;if(this.U&&(s?G(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tB(this,i,t),e8(n=e2(this.J),"RID",e),e8(n,"CVER",22),this.G&&e8(n,"X-HTTP-Session-Id",this.G),tU(this,n),s&&(this.R?t="headers="+eR(tI(s))+"&"+t:this.u&&tT(n,this.u,s)),eX(this.h,i),this.Ra&&e8(n,"TYPE","init"),this.S?(e8(n,"$req",t),e8(n,"SID","null"),i.U=!0,eF(i,n,null)):eF(i,n,t),this.I=2}}else 3==this.I&&(e?tV(this,e):0==this.i.length||eH(this.h)||tV(this))},t.Da=function(){if(this.v=null,tG(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=ex(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,e_(10),tP(this),tG(this))},t.Va=function(){null!=this.C&&(this.C=null,tP(this),tj(this),e_(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),e_(2)):(this.j.info("Failed to ping google.com"),e_(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,er),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tO(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eh(e),e=n);t.i.push(new e$(t.Ya++,e)),3==t.I&&tF(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tO(this.g),delete this.g,t0.Z.N.call(this)},v(t1,ep),v(t2,ey),v(t5,tY),t5.prototype.ra=function(){ei(this.g,"a")},t5.prototype.qa=function(e){ei(this.g,new t1(e))},t5.prototype.pa=function(e){ei(this.g,new t2)},t5.prototype.oa=function(){ei(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,h=_.createWebChannelTransport=function(){return new tZ},u=_.getStatEventTarget=function(){return eb()},l=_.Event=ew,o=_.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eD.NO_ERROR=0,eD.TIMEOUT=8,eD.HTTP_ERROR=6,a=_.ErrorCode=eD,eN.COMPLETE="complete",s=_.EventType=eN,eg.EventType=em,em.OPEN="a",em.CLOSE="b",em.ERROR="c",em.MESSAGE="d",er.prototype.listen=er.prototype.J,i=_.WebChannel=eg,_.FetchXmlHttpFactory=tp,tE.prototype.listenOnce=tE.prototype.K,tE.prototype.getLastError=tE.prototype.Ha,tE.prototype.getLastErrorCode=tE.prototype.ya,tE.prototype.getStatus=tE.prototype.ca,tE.prototype.getResponseJson=tE.prototype.La,tE.prototype.getResponseText=tE.prototype.la,tE.prototype.send=tE.prototype.ea,tE.prototype.setWithCredentials=tE.prototype.Fa,r=_.XhrIo=tE}).apply(void 0!==E?E:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let S="@firebase/firestore",x="4.9.2";class A{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}A.UNAUTHENTICATED=new A(null),A.GOOGLE_CREDENTIALS=new A("google-credentials-uid"),A.FIRST_PARTY=new A("first-party-uid"),A.MOCK_USER=new A("mock-user");let C="12.3.0",D=new v.Logger("@firebase/firestore");function N(){return D.logLevel}function k(e){D.setLogLevel(e)}function R(e,...t){if(D.logLevel<=v.LogLevel.DEBUG){let n=t.map(P);D.debug(`Firestore (${C}): ${e}`,...n)}}function M(e,...t){if(D.logLevel<=v.LogLevel.ERROR){let n=t.map(P);D.error(`Firestore (${C}): ${e}`,...n)}}function O(e,...t){if(D.logLevel<=v.LogLevel.WARN){let n=t.map(P);D.warn(`Firestore (${C}): ${e}`,...n)}}function P(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function L(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,F(e,r,n)}function F(e,t,n){let r=`FIRESTORE (${C}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw M(r),Error(r)}function V(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||F(t,i,r)}function U(e,t){e||L(57014,t)}let B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends b.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class j{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class z{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class G{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(A.UNAUTHENTICATED))}shutdown(){}}class K{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ${constructor(e){this.t=e,this.currentUser=A.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){V(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new j;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new j,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new j)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(V("string"==typeof t.accessToken,31837,{l:t}),new z(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return V(null===e||"string"==typeof e,2055,{h:e}),new A(e)}}class Q{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=A.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class H{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Q(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(A.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class W{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class J{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,y._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){V(void 0===this.o,3512);let n=e=>{null!=e.error&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,R("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new W(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(V("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new W(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class X{getToken(){return Promise.resolve(new W(""))}invalidateToken(){}start(e,t){}shutdown(){}}class Y{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Z(e,t){return e<t?-1:+(e>t)}function ee(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return et(n)===et(i)?Z(n,i):et(n)?1:-1}return Z(e.length,t.length)}function et(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function en(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let er="__name__";class ei{constructor(e,t,n){void 0===t?t=0:t>e.length&&L(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&L(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ei.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ei?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=ei.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Z(e.length,t.length)}static compareSegments(e,t){let n=ei.isNumericId(e),r=ei.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ei.extractNumericId(e).compare(ei.extractNumericId(t)):ee(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return t.fromString(e.substring(4,e.length-2))}}class es extends ei{construct(e,t,n){return new es(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new q(B.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new es(t)}static emptyPath(){return new es([])}}let ea=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class eo extends ei{construct(e,t,n){return new eo(e,t,n)}static isValidIdentifier(e){return ea.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),eo.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===er}static keyField(){return new eo([er])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new q(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new q(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new q(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new q(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new eo(t)}static emptyPath(){return new eo([])}}class el{constructor(e){this.path=e}static fromPath(e){return new el(es.fromString(e))}static fromName(e){return new el(es.fromString(e).popFirst(5))}static empty(){return new el(es.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===es.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return es.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new el(new es(e.slice()))}}function eu(e,t,n){if(!n)throw new q(B.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function eh(e,t,n,r){if(!0===t&&!0===r)throw new q(B.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function ec(e){if(!el.isDocumentKey(e))throw new q(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ed(e){if(el.isDocumentKey(e))throw new q(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ef(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function eg(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":L(12329,{type:typeof e})}function em(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new q(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=eg(e);throw new q(B.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function ep(e,t){if(t<=0)throw new q(B.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function ey(e,t){let n={typeString:e};return t&&(n.value=t),n}function ew(e,t){let n;if(!ef(e))throw new q(B.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let a=e[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new q(B.INVALID_ARGUMENT,n);return!0}class ev{static now(){return ev.fromMillis(Date.now())}static fromDate(e){return ev.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new ev(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new q(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new q(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Z(this.nanoseconds,e.nanoseconds):Z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ev._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ew(e,ev._jsonSchema))return new ev(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ev._jsonSchemaVersion="firestore/timestamp/1.0",ev._jsonSchema={type:ey("string",ev._jsonSchemaVersion),seconds:ey("number"),nanoseconds:ey("number")};class eb{static fromTimestamp(e){return new eb(e)}static min(){return new eb(new ev(0,0))}static max(){return new eb(new ev(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class eI{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function eT(e){return e.fields.find(e=>2===e.kind)}function eE(e){return e.fields.filter(e=>2!==e.kind)}function e_(e,t){let n=Z(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=eo.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:Z(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return Z(e.fields.length,t.fields.length)}eI.UNKNOWN_ID=-1;class eS{constructor(e,t){this.fieldPath=e,this.kind=t}}class ex{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ex(0,eD.min())}}function eA(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new eD(eb.fromTimestamp(1e9===r?new ev(n+1,0):new ev(n,r)),el.empty(),t)}function eC(e){return new eD(e.readTime,e.key,-1)}class eD{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new eD(eb.min(),el.empty(),-1)}static max(){return new eD(eb.max(),el.empty(),-1)}}function eN(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=el.comparator(e.documentKey,t.documentKey))?n:Z(e.largestBatchId,t.largestBatchId)}let ek="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eM(e){if(e.code!==B.FAILED_PRECONDITION||e.message!==ek)throw e;R("LocalStore","Unexpectedly lost primary lease")}class eO{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eO((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eO?t:eO.resolve(t)}catch(e){return eO.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eO.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eO.reject(t)}static resolve(e){return new eO((t,n)=>{t(e)})}static reject(e){return new eO((t,n)=>{n(e)})}static waitFor(e){return new eO((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=eO.resolve(!1);for(let n of e)t=t.next(e=>e?eO.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new eO((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new eO((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let eP="SimpleDb";class eL{static open(e,t,n,r){try{return new eL(t,e.transaction(r,n))}catch(e){throw new eB(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new j,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new eB(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=eK(t.target.error);this.S.reject(new eB(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(R(eP,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new ej(this.transaction.objectStore(e))}}class eF{static delete(e){return R(eP,"Removing database:",e),ez((0,b.getGlobal)().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,b.isIndexedDBAvailable)())return!1;if(eF.F())return!0;let e=(0,b.getUA)(),t=eF.M(e),n=eV(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){return void 0!==m.default&&"YES"===m.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,12.2===eF.M((0,b.getUA)())&&M("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(R(eP,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new eB(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new q(B.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new q(B.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new eB(e,r))},r.onupgradeneeded=e=>{R(eP,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{R(eP,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=eL.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),eO.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(R(eP,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eV(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eU{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ez(this.U.delete())}}class eB extends q{constructor(e,t){super(B.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eq(e){return"IndexedDbTransactionError"===e.name}class ej{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(R(eP,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(R(eP,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ez(n)}add(e){return R(eP,"ADD",this.store.name,e,e),ez(this.store.add(e))}get(e){return ez(this.store.get(e)).next(t=>(void 0===t&&(t=null),R(eP,"GET",this.store.name,e,t),t))}delete(e){return R(eP,"DELETE",this.store.name,e),ez(this.store.delete(e))}count(){return R(eP,"COUNT",this.store.name),ez(this.store.count())}J(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new eO((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.H(e,(e,n)=>{t.push(n)}).next(()=>t)}}Y(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new eO((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Z(e,t){R(eP,"DELETE ALL",this.store.name);let n=this.options(e,t);n.X=!1;let r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}ee(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.H(r,t)}te(e){let t=this.cursor({});return new eO((n,r)=>{t.onerror=e=>{r(eK(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}H(e,t){let n=[];return new eO((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new eU(i),a=t(i.primaryKey,i.value,s);if(a instanceof eO){let e=a.catch(e=>(s.done(),eO.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>eO.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ez(e){return new eO((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(eK(e.target.error))}})}let eG=!1;function eK(e){let t=eF.M((0,b.getUA)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new q("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eG||(eG=!0,setTimeout(()=>{throw e},0)),e}}return e}let e$="IndexBackfiller";class eQ{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){R(e$,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();R(e$,`Documents written: ${e}`)}catch(e){eq(e)?R(e$,"Ignoring IndexedDB error during index backfill: ",e):await eM(e)}await this.re(6e4)})}}class eH{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let n=new Set,r=t,i=!0;return eO.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return R(e$,`Processing collection: ${t}`),this.oe(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(r,n)).next(n=>(R(e$,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}_e(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=eC(t);eN(r,n)>0&&(n=r)}),new eD(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eW{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function eJ(e){return null==e}function eX(e){return 0===e&&1/e==-1/0}function eY(e){return"number"==typeof e&&Number.isInteger(e)&&!eX(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function eZ(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}eW.ce=-1;function e0(e){let t=e.length;if(V(t>=2,64408,{path:e}),2===t)return V("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),es.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&L(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:L(61167,{path:e})}s=t+2}return new es(r)}let e1="remoteDocuments",e2="owner",e5="owner",e6="mutationQueues",e3="mutations",e8="batchId",e4="userMutationsIndex",e7=["userId","batchId"],e9={},te="documentMutations",tt="remoteDocumentsV14",tn=["prefixPath","collectionGroup","readTime","documentId"],tr="documentKeyIndex",ti=["prefixPath","collectionGroup","documentId"],ts="collectionGroupIndex",ta=["collectionGroup","readTime","prefixPath","documentId"],to="remoteDocumentGlobal",tl="remoteDocumentGlobalKey",tu="targets",th="queryTargetsIndex",tc=["canonicalId","targetId"],td="targetDocuments",tf=["targetId","path"],tg="documentTargetsIndex",tm=["path","targetId"],tp="targetGlobalKey",ty="targetGlobal",tw="collectionParents",tv=["collectionId","parent"],tb="clientMetadata",tI="bundles",tT="namedQueries",tE="indexConfiguration",t_="collectionGroupIndex",tS="indexState",tx=["indexId","uid"],tA="sequenceNumberIndex",tC=["uid","sequenceNumber"],tD="indexEntries",tN=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tk="documentKeyIndex",tR=["indexId","uid","orderedDocumentKey"],tM="documentOverlays",tO=["userId","collectionPath","documentId"],tP="collectionPathOverlayIndex",tL=["userId","collectionPath","largestBatchId"],tF="collectionGroupOverlayIndex",tV=["userId","collectionGroup","largestBatchId"],tU="globals",tB=[e6,e3,te,e1,tu,e2,ty,td,tb,to,tw,tI,tT],tq=[...tB,tM],tj=[e6,e3,te,tt,tu,e2,ty,td,tb,to,tw,tI,tT,tM],tz=[...tj,tE,tS,tD],tG=[...tz,tU];class tK extends eR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function t$(e,t){return eF.O(e.le,t)}function tQ(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tH(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function tW(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function tJ(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tX{constructor(e,t){this.comparator=e,this.root=t||tZ.EMPTY}insert(e,t){return new tX(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tZ.BLACK,null,null))}remove(e){return new tX(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tZ.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tY(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tY(this.root,e,this.comparator,!1)}getReverseIterator(){return new tY(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tY(this.root,e,this.comparator,!0)}}class tY{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tZ{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:tZ.RED,this.left=null!=r?r:tZ.EMPTY,this.right=null!=i?i:tZ.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new tZ(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return tZ.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return tZ.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tZ.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tZ.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw L(27949);return e+ +!this.isRed()}}tZ.EMPTY=null,tZ.RED=!0,tZ.BLACK=!1,tZ.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new tZ(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class t0{constructor(e){this.comparator=e,this.data=new tX(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new t1(this.data.getIterator())}getIteratorFrom(e){return new t1(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof t0)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new t0(this.comparator);return t.data=e,t}}class t1{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function t2(e){return e.hasNext()?e.getNext():void 0}class t5{constructor(e){this.fields=e,e.sort(eo.comparator)}static empty(){return new t5([])}unionWith(e){let t=new t0(eo.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new t5(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return en(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class t6 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function t3(){return"undefined"!=typeof atob}class t8{constructor(e){this.binaryString=e}static fromBase64String(e){return new t8(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new t6("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new t8(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}t8.EMPTY_BYTE_STRING=new t8("");let t4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function t7(e){if(V(!!e,39018),"string"==typeof e){let t=0,n=t4.exec(e);if(V(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:t9(e.seconds),nanos:t9(e.nanos)}}function t9(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ne(e){return"string"==typeof e?t8.fromBase64String(e):t8.fromUint8Array(e)}let nt="server_timestamp",nn="__type__",nr="__previous_value__",ni="__local_write_time__";function ns(e){return(e?.mapValue?.fields||{})[nn]?.stringValue===nt}function na(e){let t=e.mapValue.fields[nr];return ns(t)?na(t):t}function no(e){let t=t7(e.mapValue.fields[ni].timestampValue);return new ev(t.seconds,t.nanos)}class nl{constructor(e,t,n,r,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let nu="(default)";class nh{constructor(e,t){this.projectId=e,this.database=t||nu}static empty(){return new nh("","")}get isDefaultDatabase(){return this.database===nu}isEqual(e){return e instanceof nh&&e.projectId===this.projectId&&e.database===this.database}}let nc="__type__",nd="__max__",nf={mapValue:{fields:{__type__:{stringValue:nd}}}},ng="__vector__",nm="value",np={nullValue:"NULL_VALUE"};function ny(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ns(e)?4:nR(e)?0x1fffffffffffff:nN(e)?10:11:L(28295,{value:e})}function nw(e,t){if(e===t)return!0;let n=ny(e);if(n!==ny(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return no(e).isEqual(no(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=t7(e.timestampValue),i=t7(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return ne(e.bytesValue).isEqual(ne(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return t9(e.geoPointValue.latitude)===t9(t.geoPointValue.latitude)&&t9(e.geoPointValue.longitude)===t9(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return t9(e.integerValue)===t9(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=t9(e.doubleValue),r=t9(t.doubleValue);return n===r?eX(n)===eX(r):isNaN(n)&&isNaN(r)}return!1;case 9:return en(e.arrayValue.values||[],t.arrayValue.values||[],nw);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(tQ(s)!==tQ(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nw(s[e],a[e])))return!1;return!0;default:return L(52216,{left:e})}}function nv(e,t){return void 0!==(e.values||[]).find(e=>nw(e,t))}function nb(e,t){var n,r,i,s,a,o;if(e===t)return 0;let l=ny(e),u=ny(t);if(l!==u)return Z(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return Z(e.booleanValue,t.booleanValue);case 2:let h,c;return h=t9(e.integerValue||e.doubleValue),h<(c=t9(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return nI(e.timestampValue,t.timestampValue);case 4:return nI(no(e),no(t));case 5:return ee(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,r=t.bytesValue,d=ne(n),f=ne(r),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=Z(n[e],r[e]);if(0!==t)return t}return Z(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let g;return i=e.geoPointValue,s=t.geoPointValue,0!==(g=Z(t9(i.latitude),t9(s.latitude)))?g:Z(t9(i.longitude),t9(s.longitude));case 9:return nT(e.arrayValue,t.arrayValue);case 10:let m,p,y,w,v;return a=e.mapValue,o=t.mapValue,m=a.fields||{},p=o.fields||{},y=m[nm]?.arrayValue,w=p[nm]?.arrayValue,0!==(v=Z(y?.values?.length||0,w?.values?.length||0))?v:nT(y,w);case 11:return function(e,t){if(e===nf.mapValue&&t===nf.mapValue)return 0;if(e===nf.mapValue)return 1;if(t===nf.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=ee(r[e],s[e]);if(0!==t)return t;let a=nb(n[r[e]],i[s[e]]);if(0!==a)return a}return Z(r.length,s.length)}(e.mapValue,t.mapValue);default:throw L(23264,{he:l})}}function nI(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Z(e,t);let n=t7(e),r=t7(t),i=Z(n.seconds,r.seconds);return 0!==i?i:Z(n.nanos,r.nanos)}function nT(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=nb(n[e],r[e]);if(t)return t}return Z(n.length,r.length)}function nE(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=t7(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?ne(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,el.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=nE(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${nE(e.fields[i])}`;return n+"}"}(e.mapValue):L(61005,{value:e})}function n_(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function nS(e){return!!e&&"integerValue"in e}function nx(e){return!!e&&"arrayValue"in e}function nA(e){return!!e&&"nullValue"in e}function nC(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nD(e){return!!e&&"mapValue"in e}function nN(e){return(e?.mapValue?.fields||{})[nc]?.stringValue===ng}function nk(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return tH(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=nk(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=nk(e.arrayValue.values[n]);return t}return{...e}}function nR(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nd}let nM={mapValue:{fields:{[nc]:{stringValue:ng},[nm]:{arrayValue:{}}}}};function nO(e,t){let n=nb(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function nP(e,t){let n=nb(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nL{constructor(e){this.value=e}static empty(){return new nL({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!nD(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nk(t)}setAll(e){let t=eo.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=nk(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());nD(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nw(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nD(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(tH(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new nL(nk(this.value))}}class nF{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new nF(e,0,eb.min(),eb.min(),eb.min(),nL.empty(),0)}static newFoundDocument(e,t,n,r){return new nF(e,1,t,eb.min(),n,r,0)}static newNoDocument(e,t){return new nF(e,2,t,eb.min(),eb.min(),nL.empty(),0)}static newUnknownDocument(e,t){return new nF(e,3,t,eb.min(),eb.min(),nL.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(eb.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nL.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nL.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=eb.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nF&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nF(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class nV{constructor(e,t){this.position=e,this.inclusive=t}}function nU(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?el.comparator(el.fromName(a.referenceValue),n.key):nb(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function nB(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nw(e.position[n],t.position[n]))return!1;return!0}class nq{constructor(e,t="asc"){this.field=e,this.dir=t}}class nj{}class nz extends nj{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new nJ(e,t,n):"array-contains"===t?new n0(e,n):"in"===t?new n1(e,n):"not-in"===t?new n2(e,n):"array-contains-any"===t?new n5(e,n):new nz(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new nX(e,n):new nY(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(nb(t,this.value)):null!==t&&ny(this.value)===ny(t)&&this.matchesComparison(nb(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nG extends nj{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new nG(e,t)}matches(e){return nK(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function nK(e){return"and"===e.op}function n$(e){return"or"===e.op}function nQ(e){return nH(e)&&nK(e)}function nH(e){for(let t of e.filters)if(t instanceof nG)return!1;return!0}function nW(e,t){let n=e.filters.concat(t);return nG.create(n,e.op)}class nJ extends nz{constructor(e,t,n){super(e,t,n),this.key=el.fromName(n.referenceValue)}matches(e){let t=el.comparator(e.key,this.key);return this.matchesComparison(t)}}class nX extends nz{constructor(e,t){super(e,"in",t),this.keys=nZ("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nY extends nz{constructor(e,t){super(e,"not-in",t),this.keys=nZ("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function nZ(e,t){return(t.arrayValue?.values||[]).map(e=>el.fromName(e.referenceValue))}class n0 extends nz{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return nx(t)&&nv(t.arrayValue,this.value)}}class n1 extends nz{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nv(this.value.arrayValue,t)}}class n2 extends nz{constructor(e,t){super(e,"not-in",t)}matches(e){if(nv(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!nv(this.value.arrayValue,t)}}class n5 extends nz{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!nx(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>nv(this.value.arrayValue,e))}}class n6{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function n3(e,t=null,n=[],r=[],i=null,s=null,a=null){return new n6(e,t,n,r,i,s,a)}function n8(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof nz)return t.field.canonicalString()+t.op.toString()+nE(t.value);if(nQ(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),eJ(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>nE(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>nE(e)).join(",")),e.Te=t}return e.Te}function n4(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof nz?n instanceof nz&&t.op===n.op&&t.field.isEqual(n.field)&&nw(t.value,n.value):t instanceof nG?n instanceof nG&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void L(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!nB(e.startAt,t.startAt)&&nB(e.endAt,t.endAt)}function n7(e){return el.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function n9(e,t){return e.filters.filter(e=>e instanceof nz&&e.field.isEqual(t))}function re(e,t,n){let r=np,i=!0;for(let n of n9(e,t)){let e=np,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?np:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?n_(nh.empty(),el.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?nN(s)?nM:{mapValue:{}}:L(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=np}0>nO({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>nO({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function rt(e,t,n){let r=nf,i=!0;for(let n of n9(e,t)){let e=nf,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?n_(nh.empty(),el.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?nM:"mapValue"in s?nN(s)?{mapValue:{}}:nf:L(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=nf}nP({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];nP({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class rn{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function rr(e){return new rn(e)}function ri(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rs(e){return null!==e.collectionGroup}function ra(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new t0(eo.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new nq(t,r))}),n.has(eo.keyField().canonicalString())||e.Ie.push(new nq(eo.keyField(),r))}return e.Ie}function ro(e){return e.Ee||(e.Ee=ru(e,ra(e))),e.Ee}function rl(e){return e.de||(e.de=ru(e,e.explicitOrderBy)),e.de}function ru(e,t){if("F"===e.limitType)return n3(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new nq(e.field,t)});let n=e.endAt?new nV(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new nV(e.startAt.position,e.startAt.inclusive):null;return n3(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function rh(e,t){let n=e.filters.concat([t]);return new rn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function rc(e,t,n){return new rn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rd(e,t){return n4(ro(e),ro(t))&&e.limitType===t.limitType}function rf(e){return`${n8(ro(e))}|lt:${e.limitType}`}function rg(e){var t;let n;return`Query(target=${n=(t=ro(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof nz?`${t.field.canonicalString()} ${t.op} ${nE(t.value)}`:t instanceof nG?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),eJ(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>nE(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>nE(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rm(e,t){var n,r,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):el.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of ra(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,o=nU(i,ra(n),r),i.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=nU(s,ra(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function rp(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ry(e){return(t,n)=>{let r=!1;for(let i of ra(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?el.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?nb(i,s):L(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return L(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class rw{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tH(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return tJ(this.inner)}size(){return this.innerSize}}let rv=new tX(el.comparator),rb=new tX(el.comparator);function rI(...e){let t=rb;for(let n of e)t=t.insert(n.key,n);return t}function rT(e){let t=rb;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function rE(){return new rw(e=>e.toString(),(e,t)=>e.isEqual(t))}let r_=new tX(el.comparator),rS=new t0(el.comparator);function rx(...e){let t=rS;for(let n of e)t=t.add(n);return t}let rA=new t0(Z);function rC(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eX(t)?"-0":t}}function rD(e){return{integerValue:""+e}}function rN(e,t){return eY(t)?rD(t):rC(e,t)}class rk{constructor(){this._=void 0}}function rR(e,t){return e instanceof rV?nS(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class rM extends rk{}class rO extends rk{constructor(e){super(),this.elements=e}}function rP(e,t){let n=rB(t);for(let t of e.elements)n.some(e=>nw(e,t))||n.push(t);return{arrayValue:{values:n}}}class rL extends rk{constructor(e){super(),this.elements=e}}function rF(e,t){let n=rB(t);for(let t of e.elements)n=n.filter(e=>!nw(e,t));return{arrayValue:{values:n}}}class rV extends rk{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function rU(e){return t9(e.integerValue||e.doubleValue)}function rB(e){return nx(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class rq{constructor(e,t){this.field=e,this.transform=t}}class rj{constructor(e,t){this.version=e,this.transformResults=t}}class rz{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rz}static exists(e){return new rz(void 0,e)}static updateTime(e){return new rz(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rG(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class rK{}function r$(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new r0(e.key,rz.none()):new rW(e.key,e.data,rz.none());{let n=e.data,r=nL.empty(),i=new t0(eo.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new rJ(e.key,r,new t5(i.toArray()),rz.none())}}function rQ(e,t,n,r){return e instanceof rW?function(e,t,n,r){if(!rG(e.precondition,t))return n;let i=e.value.clone(),s=rZ(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof rJ?function(e,t,n,r){if(!rG(e.precondition,t))return n;let i=rZ(e.fieldTransforms,r,t),s=t.data;return(s.setAll(rX(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):rG(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function rH(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&en(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof rO&&r instanceof rO||n instanceof rL&&r instanceof rL?en(n.elements,r.elements,nw):n instanceof rV&&r instanceof rV?nw(n.Ae,r.Ae):n instanceof rM&&r instanceof rM)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class rW extends rK{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class rJ extends rK{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rX(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function rY(e,t,n){let r=new Map;V(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof rO?rP(o,l):o instanceof rL?rF(o,l):i))}return r}function rZ(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof rM?(r=t,i={fields:{[nn]:{stringValue:nt},[ni]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&ns(r)&&(r=na(r)),r&&(i.fields[nr]=r),{mapValue:i}):e instanceof rO?rP(e,t):e instanceof rL?rF(e,t):(a=rU(s=rR(e,t))+rU(e.Ae),nS(s)&&nS(e.Ae)?rD(a):rC(e.serializer,a))}(e,s,t))}return r}class r0 extends rK{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class r1 extends rK{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class r2{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof rW?(r=e.value.clone(),i=rY(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof rJ?function(e,t,n){if(!rG(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=rY(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(rX(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=rQ(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=rQ(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=rE();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=r$(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(eb.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rx())}isEqual(e){return this.batchId===e.batchId&&en(this.mutations,e.mutations,(e,t)=>rH(e,t))&&en(this.baseMutations,e.baseMutations,(e,t)=>rH(e,t))}}class r5{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){V(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=r_,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new r5(e,t,n,r)}}class r6{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class r3{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class r8{constructor(e,t){this.count=e,this.unchangedNames=t}}function r4(e){switch(e){case B.OK:return L(64938);case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0;default:return L(15467,{code:e})}}function r7(e){if(void 0===e)return M("GRPC error has no .code"),B.UNKNOWN;switch(e){case c.OK:return B.OK;case c.CANCELLED:return B.CANCELLED;case c.UNKNOWN:return B.UNKNOWN;case c.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case c.INTERNAL:return B.INTERNAL;case c.UNAVAILABLE:return B.UNAVAILABLE;case c.UNAUTHENTICATED:return B.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case c.NOT_FOUND:return B.NOT_FOUND;case c.ALREADY_EXISTS:return B.ALREADY_EXISTS;case c.PERMISSION_DENIED:return B.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case c.ABORTED:return B.ABORTED;case c.OUT_OF_RANGE:return B.OUT_OF_RANGE;case c.UNIMPLEMENTED:return B.UNIMPLEMENTED;case c.DATA_LOSS:return B.DATA_LOSS;default:return L(39323,{code:e})}}(d=c||(c={}))[d.OK=0]="OK",d[d.CANCELLED=1]="CANCELLED",d[d.UNKNOWN=2]="UNKNOWN",d[d.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",d[d.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",d[d.NOT_FOUND=5]="NOT_FOUND",d[d.ALREADY_EXISTS=6]="ALREADY_EXISTS",d[d.PERMISSION_DENIED=7]="PERMISSION_DENIED",d[d.UNAUTHENTICATED=16]="UNAUTHENTICATED",d[d.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",d[d.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",d[d.ABORTED=10]="ABORTED",d[d.OUT_OF_RANGE=11]="OUT_OF_RANGE",d[d.UNIMPLEMENTED=12]="UNIMPLEMENTED",d[d.INTERNAL=13]="INTERNAL",d[d.UNAVAILABLE=14]="UNAVAILABLE",d[d.DATA_LOSS=15]="DATA_LOSS";let r9=null;function ie(){return new TextEncoder}let it=new t([0xffffffff,0xffffffff],0);function ir(e){let t=ie().encode(e),r=new n;return r.update(t),new Uint8Array(r.digest())}function ii(e){let n=new DataView(e.buffer),r=n.getUint32(0,!0),i=n.getUint32(4,!0),s=n.getUint32(8,!0),a=n.getUint32(12,!0);return[new t([r,i],0),new t([s,a],0)]}class is{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ia(`Invalid padding: ${n}`);if(r<0||e.length>0&&0===this.hashCount)throw new ia(`Invalid hash count: ${r}`);if(0===e.length&&0!==n)throw new ia(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=t.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(t.fromNumber(r)));return 1===i.compare(it)&&(i=new t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=ii(ir(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new is(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=ii(ir(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ia extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class io{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,il.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new io(eb.min(),r,new tX(Z),rv,rx())}}class il{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new il(n,t,rx(),rx(),rx())}}class iu{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class ih{constructor(e,t){this.targetId=e,this.Ce=t}}class ic{constructor(e,t,n=t8.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class id{constructor(){this.ve=0,this.Fe=ip(),this.Me=t8.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=rx(),t=rx(),n=rx();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:L(38017,{changeType:i})}}),new il(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=ip()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,V(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ig{constructor(e){this.Ge=e,this.ze=new Map,this.je=rv,this.Je=im(),this.He=im(),this.Ye=new tX(Z)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:L(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let a=r.target;if(n7(a))if(0===n){let e=new el(a.path);this.et(t,e,nF.newNoDocument(e,eb.min()))}else V(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){var i,s;let n,a,o=this.ut(e),l=o?this.ct(o,e,r):1;0!==l&&(this.it(t),this.Ye=this.Ye.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),r9?.lt((i=e.Ce,s=this.Ge.ht(),n={localCacheCount:r,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(n.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),n))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=ne(i).toUint8Array()}catch(e){if(e instanceof t6)return O("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new is(t,s,a)}catch(e){return O(e instanceof ia?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&n7(i.target)){let t=new el(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,nF.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=rx();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new io(e,t,this.Ye,this.je,n);return this.je=rv,this.Je=im(),this.He=im(),this.Ye=new tX(Z),r}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new id,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new t0(Z),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new t0(Z),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||R("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new id),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function im(){return new tX(el.comparator)}function ip(){return new tX(el.comparator)}let iy={asc:"ASCENDING",desc:"DESCENDING"},iw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iv={and:"AND",or:"OR"};class ib{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iI(e,t){return e.useProto3Json||eJ(t)?t:{value:t}}function iT(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iE(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function i_(e){let t;return V(!!e,49232),eb.fromTimestamp(new ev((t=t7(e)).seconds,t.nanos))}function iS(e,t){return ix(e,t).canonicalString()}function ix(e,t){let n=new es(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function iA(e){let t=es.fromString(e);return V(iG(t),10190,{key:t.toString()}),t}function iC(e,t){return iS(e.databaseId,t.path)}function iD(e,t){let n=iA(t);if(n.get(1)!==e.databaseId.projectId)throw new q(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new q(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new el(iM(n))}function iN(e,t){return iS(e.databaseId,t)}function ik(e){let t=iA(e);return 4===t.length?es.emptyPath():iM(t)}function iR(e){return new es(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iM(e){return V(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iO(e,t,n){return{name:iC(e,t),fields:n.value.mapValue.fields}}function iP(e,t,n){let r=iD(e,t.name),i=i_(t.updateTime),s=t.createTime?i_(t.createTime):eb.min(),a=new nL({mapValue:{fields:t.fields}}),o=nF.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function iL(e,t){var n,r;let i;if(t instanceof rW)i={update:iO(e,t.key,t.value)};else if(t instanceof r0)i={delete:iC(e,t.key)};else if(t instanceof rJ){let n;i={update:iO(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof r1))return L(16599,{Vt:t.type});i={verify:iC(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof rM)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof rO)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof rL)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof rV)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw L(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:iT(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:L(27497)),i}function iF(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?rz.updateTime(i_(n.updateTime)):void 0!==n.exists?rz.exists(n.exists):rz.none():rz.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(V("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new rM):"appendMissingElements"in t?n=new rO(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new rL(t.removeAllFromArray.values||[]):"increment"in t?n=new rV(e,t.increment):L(16584,{proto:t}),new rq(eo.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=iD(e,t.update.name),s=new nL({mapValue:{fields:t.update.fields}});return t.updateMask?new rJ(n,s,new t5((t.updateMask.fieldPaths||[]).map(e=>eo.fromServerFormat(e))),r,i):new rW(n,s,r,i)}return t.delete?new r0(iD(e,t.delete),r):t.verify?new r1(iD(e,t.verify),r):L(1463,{proto:t})}function iV(e,t){return{documents:[iN(e,t.path)]}}function iU(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=iN(e,i);let o=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof nz?function(e){if("=="===e.op){if(nC(e.value))return{unaryFilter:{field:ij(e.field),op:"IS_NAN"}};if(nA(e.value))return{unaryFilter:{field:ij(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nC(e.value))return{unaryFilter:{field:ij(e.field),op:"IS_NOT_NAN"}};if(nA(e.value))return{unaryFilter:{field:ij(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ij(e.field),op:iw[e.op],value:e.value}}}(t):t instanceof nG?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:iv[n.op],filters:r}}:L(54877,{filter:t})}(nG.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:ij(e.field),direction:iy[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=iI(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ft:s,parent:i}}function iB(e,t,n,r){let{ft:i,parent:s}=iU(e,t),a={},o=[],l=0;return n.forEach(e=>{let t=r?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:ij(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:ij(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}function iq(e){var t,n,r;let i,s,a,o,l=ik(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){V(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iz(e.unaryFilter.field);return nz.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=iz(e.unaryFilter.field);return nz.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=iz(e.unaryFilter.field);return nz.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iz(e.unaryFilter.field);return nz.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}}(t):void 0!==t.fieldFilter?nz.create(iz(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?nG.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return L(1026)}}(t.compositeFilter.op)):L(30097,{filter:t})}(u.where))instanceof nG&&nQ(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new nq(iz(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=eJ(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let m=null;u.startAt&&(a=!!(n=u.startAt).before,m=new nV(n.values||[],a));let p=null;return u.endAt&&(o=!(r=u.endAt).before,p=new nV(r.values||[],o)),new rn(l,c,f,d,g,"F",m,p)}function ij(e){return{fieldPath:e.canonicalString()}}function iz(e){return eo.fromServerFormat(e.fieldPath)}function iG(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iK{constructor(e,t,n,r,i=eb.min(),s=eb.min(),a=t8.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iK(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iK(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class i${constructor(e){this.yt=e}}function iQ(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:iH(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:iC(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:iT(i,t.version.toTimestamp()),createTime:iT(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:iW(t.version)};else{if(!t.isUnknownDocument())return L(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:iW(t.version)}}return r}function iH(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iW(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iJ(e){let t=new ev(e.seconds,e.nanoseconds);return eb.fromTimestamp(t)}function iX(e,t){let n=(t.baseMutations||[]).map(t=>iF(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>iF(e.yt,t)),i=ev.fromMillis(t.localWriteTimeMs);return new r2(t.batchId,i,n,r)}function iY(e){var t;let n,r=iJ(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?iJ(e.lastLimboFreeSnapshotVersion):eb.min();return new iK(void 0!==e.query.documents?(V(1===(n=(t=e.query).documents.length),1966,{count:n}),ro(rr(ik(t.documents[0])))):ro(iq(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,t8.fromBase64String(e.resumeToken))}function iZ(e,t){let n,r=iW(t.snapshotVersion),i=iW(t.lastLimboFreeSnapshotVersion);n=n7(t.target)?iV(e.yt,t.target):iU(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:n8(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function i0(e){let t=iq({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?rc(t,t.limit,"L"):t}function i1(e,t){return new r6(t.largestBatchId,iF(e.yt,t.overlayMutation))}function i2(e,t){let n=t.path.lastSegment();return[e,eZ(t.path.popLast()),n]}function i5(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:iW(r.readTime),documentKey:eZ(r.documentKey.path),largestBatchId:r.largestBatchId}}class i6{getBundleMetadata(e,t){return t$(e,tI).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:iJ(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return t$(e,tI).put({bundleId:t.id,createTime:iW(i_(t.createTime)),version:t.version})}getNamedQuery(e,t){return t$(e,tT).get(t).next(e=>{if(e)return{name:e.name,query:i0(e.bundledQuery),readTime:iJ(e.readTime)}})}saveNamedQuery(e,t){return t$(e,tT).put({name:t.name,readTime:iW(i_(t.readTime)),bundledQuery:t.bundledQuery})}}class i3{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new i3(e,t.uid||"")}getOverlay(e,t){return t$(e,tM).get(i2(this.userId,t)).next(e=>e?i1(this.serializer,e):null)}getOverlays(e,t){let n=rE();return eO.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new r6(t,i);r.push(this.St(e,s))}),eO.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(eZ(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(t$(e,tM).Z(tP,r))}),eO.waitFor(i)}getOverlaysForCollection(e,t,n){let r=rE(),i=eZ(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return t$(e,tM).J(tP,s).next(e=>{for(let t of e){let e=i1(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=rE(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return t$(e,tM).ee({index:tF,range:a},(e,t,n)=>{let a=i1(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}St(e,t){return t$(e,tM).put(function(e,t,n){let[r,i,s]=i2(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:iL(e.yt,n.mutation)}}(this.serializer,this.userId,t))}}class i8{bt(e){return t$(e,tU)}getSessionToken(e){return this.bt(e).get("sessionToken").next(e=>{let t=e?.value;return t?t8.fromUint8Array(t):t8.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class i4{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(t9(e.integerValue));else if("doubleValue"in e){let n=t9(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),eX(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=t7(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ne(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?nR(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):nN(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):L(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[nm].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(t9(r)),this.Ot(nm,t),this.Ct(n[nm],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),el.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function i7(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}i4.Kt=new i4;class i9{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Ht()}Xt(e){let t=this.en(e),n=i7(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),n=i7(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=!!(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Jt(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class se{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class st{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class sn{constructor(){this.cn=new i9,this.ln=new se(this.cn),this.hn=new st(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return 0===e?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class sr{constructor(e,t,n,r){this.Tn=e,this.In=t,this.En=n,this.dn=r}An(){let e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new sr(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:sa(this.En),directionalValue:sa(this.dn),orderedDocumentKey:sa(t),documentKey:n.path.toArray()}}Vn(e,t,n){let r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function si(e,t){let n=e.Tn-t.Tn;return 0!==n||0!==(n=ss(e.En,t.En))||0!==(n=ss(e.dn,t.dn))?n:el.comparator(e.In,t.In)}function ss(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function sa(e){return(0,b.isSafariOrWebkit)()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function so(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class sl{constructor(e){for(const t of(this.mn=new t0((e,t)=>eo.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[],e.filters))t.isInequality()?this.mn=this.mn.add(t):this.gn.push(t)}get pn(){return this.mn.size>1}yn(e){if(V(e.collectionGroup===this.collectionId,49279),this.pn)return!1;let t=eT(e);if(void 0!==t&&!this.wn(t))return!1;let n=eE(e),r=new Set,i=0,s=0;for(;i<n.length&&this.wn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){let e=this.mn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.Sn(e,t)||!this.bn(this.fn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.fn.length||!this.bn(this.fn[s++],e))return!1}return!0}Dn(){if(this.pn)return null;let e=new t0(eo.comparator),t=[];for(let n of this.gn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new eS(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new eS(n.field,0))}for(let n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new eS(n.field,+("asc"!==n.dir))));return new eI(eI.UNKNOWN_ID,this.collectionId,t,ex.empty())}wn(e){for(let t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function su(e){return e instanceof nz}function sh(e){return e instanceof nG&&nQ(e)}function sc(e){return su(e)||sh(e)||function(e){if(e instanceof nG&&n$(e)){for(let t of e.getFilters())if(!su(t)&&!sh(t))return!1;return!0}return!1}(e)}function sd(e,t){return V(e instanceof nz||e instanceof nG,38388),V(t instanceof nz||t instanceof nG,25473),sg(e instanceof nz?t instanceof nz?nG.create([e,t],"and"):sf(e,t):t instanceof nz?sf(t,e):function(e,t){if(V(e.filters.length>0&&t.filters.length>0,48005),nK(e)&&nK(t))return nW(e,t.getFilters());let n=n$(e)?e:t,r=n$(e)?t:e,i=n.filters.map(e=>sd(e,r));return nG.create(i,"or")}(e,t))}function sf(e,t){if(nK(t))return nW(t,e.getFilters());{let n=t.filters.map(t=>sd(e,t));return nG.create(n,"or")}}function sg(e){if(V(e instanceof nz||e instanceof nG,11850),e instanceof nz)return e;let t=e.getFilters();if(1===t.length)return sg(t[0]);if(nH(e))return e;let n=t.map(e=>sg(e)),r=[];return n.forEach(t=>{t instanceof nz?r.push(t):t instanceof nG&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:nG.create(r,e.op)}class sm{constructor(){this.Cn=new sp}addToCollectionParentIndex(e,t){return this.Cn.add(t),eO.resolve()}getCollectionParents(e,t){return eO.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return eO.resolve()}deleteFieldIndex(e,t){return eO.resolve()}deleteAllFieldIndexes(e){return eO.resolve()}createTargetIndexes(e,t){return eO.resolve()}getDocumentsMatchingTarget(e,t){return eO.resolve(null)}getIndexType(e,t){return eO.resolve(0)}getFieldIndexes(e,t){return eO.resolve([])}getNextCollectionGroupToUpdate(e){return eO.resolve(null)}getMinOffset(e,t){return eO.resolve(eD.min())}getMinOffsetFromCollectionGroup(e,t){return eO.resolve(eD.min())}updateCollectionGroup(e,t,n){return eO.resolve()}updateIndexEntries(e,t){return eO.resolve()}}class sp{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new t0(es.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new t0(es.comparator)).toArray()}}let sy="IndexedDbIndexManager",sw=new Uint8Array(0);class sv{constructor(e,t){this.databaseId=t,this.vn=new sp,this.Fn=new rw(e=>n8(e),(e,t)=>n4(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let i={collectionId:n,parent:eZ(r)};return t$(e,tw).put(i)}return eO.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return t$(e,tw).J(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(e0(r.parent))}return n})}addFieldIndex(e,t){let n=t$(e,tE),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=t$(e,tS);return i.next(e=>{n.put(i5(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=t$(e,tE),r=t$(e,tS),i=t$(e,tD);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=t$(e,tE),n=t$(e,tD),r=t$(e,tS);return t.Z().next(()=>n.Z()).next(()=>r.Z())}createTargetIndexes(e,t){return eO.forEach(this.Mn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new sl(t).Dn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=t$(e,tD),r=!0,i=new Map;return eO.forEach(this.Mn(t),t=>this.xn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=rx(),r=[];return eO.forEach(i,(i,s)=>{R(sy,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${n8(t)}`);let a=function(e,t){let n=eT(t);if(void 0===n)return null;for(let t of n9(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of eE(t))for(let t of n9(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of eE(t)){let t=0===i.kind?re(e,i.fieldPath,e.startAt):rt(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new nV(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of eE(t)){let t=0===i.kind?rt(e,i.fieldPath,e.endAt):re(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new nV(n,r)}(s,i),h=this.On(i,s,l),c=this.On(i,s,u),d=this.Nn(i,s,o),f=this.Bn(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return eO.forEach(f,i=>n.Y(i,t.limit).next(t=>{t.forEach(t=>{let n=el.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return eO.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(V(t instanceof nz||t instanceof nG,34018),t instanceof nz)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=nG.create(n,t.op);return sc(r=sg(r))?r:(V(r instanceof nG,64498),V(nK(r),40251),V(r.filters.length>1,57927),r.filters.reduce((e,t)=>sd(e,t)))}(function e(t){if(V(t instanceof nz||t instanceof nG,20012),t instanceof nz){if(t instanceof n1){let e=t.value.arrayValue?.values?.map(e=>nz.create(t.field,"==",e))||[];return nG.create(e,"or")}return t}let n=t.filters.map(t=>e(t));return nG.create(n,t.op)}(e));return V(sc(t),7391),su(t)||sh(t)?[t]:t.getFilters()})(nG.create(e.filters,"and")).map(t=>n3(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t)),t}Bn(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Ln(t[h/l]):sw,c=this.kn(e,o,n[h%l],r),d=this.qn(e,o,i[h%l],s),f=a.map(t=>this.kn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}kn(e,t,n,r){let i=new sr(e,el.empty(),t,n);return r?i:i.An()}qn(e,t,n,r){let i=new sr(e,el.empty(),t,n);return r?i.An():i}xn(e,t){let n=new sl(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.yn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.Mn(t);return eO.forEach(r,t=>this.xn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new t0(eo.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}Qn(e,t){let n=new sn;for(let r of eE(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.Pn(r.kind);i4.Kt.Dt(e,i)}return n.un()}Ln(e){let t=new sn;return i4.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){let n,r=new sn;return i4.Kt.Dt(n_(this.databaseId,t),r.Pn(0===(n=eE(e)).length?0:n[n.length-1].kind)),r.un()}Nn(e,t,n){if(null===n)return[];let r=[];r.push(new sn);let i=0;for(let s of eE(e)){let e=n[i++];for(let n of r)if(this.Un(t,s.fieldPath)&&nx(e))r=this.Kn(r,s,e);else{let t=n.Pn(s.kind);i4.Kt.Dt(e,t)}}return this.Wn(r)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new sn;r.seed(n.un()),i4.Kt.Dt(e,r.Pn(t.kind)),i.push(r)}return i}Un(e,t){return!!e.filters.find(e=>e instanceof nz&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=t$(e,tE),r=t$(e,tS);return(t?n.J(t_,IDBKeyRange.bound(t,t)):n.J()).next(e=>{let t=[];return eO.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new ex(n.sequenceNumber,new eD(iJ(n.readTime),new el(e0(n.documentKey)),n.largestBatchId)):ex.empty(),i=e.fields.map(([e,t])=>new eS(eo.fromServerFormat(e),t)),new eI(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Z(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=t$(e,tE),i=t$(e,tS);return this.Gn(e).next(e=>r.J(t_,IDBKeyRange.bound(t,t)).next(t=>eO.forEach(t,t=>i.put(i5(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return eO.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?eO.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),eO.forEach(i,n=>this.zn(e,t,n).next(t=>{let i=this.jn(r,n);return t.isEqual(i)?eO.resolve():this.Jn(e,r,n,t,i)}))))})}Hn(e,t,n,r){return t$(e,tD).put(r.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,r){return t$(e,tD).delete(r.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){let r=t$(e,tD),i=new t0(si);return r.ee({index:tk,range:IDBKeyRange.only([n.indexId,this.uid,sa(this.$n(n,t))])},(e,r)=>{i=i.add(new sr(n.indexId,t,so(r.arrayValue),so(r.directionalValue)))}).next(()=>i)}jn(e,t){let n=new t0(si),r=this.Qn(t,e);if(null==r)return n;let i=eT(t);if(null!=i){let s=e.data.field(i.fieldPath);if(nx(s))for(let i of s.arrayValue.values||[])n=n.add(new sr(t.indexId,e.key,this.Ln(i),r))}else n=n.add(new sr(t.indexId,e.key,sw,r));return n}Jn(e,t,n,r,i){R(sy,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=t2(s),l=t2(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=t2(a)):t?(i(o),o=t2(s)):(o=t2(s),l=t2(a))}}(r,i,si,r=>{s.push(this.Hn(e,t,n,r))},r=>{s.push(this.Yn(e,t,n,r))}),eO.waitFor(s)}Gn(e){let t=1;return t$(e,tS).ee({index:tA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>si(e,t)).filter((e,t,n)=>!t||0!==si(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=si(i,e),s=si(i,t);if(0===n)r[0]=e.An();else if(n>0&&s<0)r.push(i),r.push(i.An());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Zn(r[e],r[e+1]))return[];let t=r[e].Vn(this.uid,sw,el.empty()),n=r[e+1].Vn(this.uid,sw,el.empty());i.push(IDBKeyRange.bound(t,n))}return i}Zn(e,t){return si(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sb)}getMinOffset(e,t){return eO.mapArray(this.Mn(t),t=>this.xn(e,t).next(e=>e||L(44426))).next(sb)}}function sb(e){V(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>eN(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new eD(t.readTime,t.documentKey,n)}let sI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sT{static withCacheSize(e){return new sT(e,sT.DEFAULT_COLLECTION_PERCENTILE,sT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function sE(e,t,n){let r=e.store(e3),i=e.store(te),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.ee({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{V(1===o,47070,{batchId:n.batchId})}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,eZ(h),c]);s.push(i.delete(r)),u.push(e.key)}return eO.waitFor(s).next(()=>u)}function s_(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw L(14731);t=e.noDocument}return JSON.stringify(t).length}sT.DEFAULT_COLLECTION_PERCENTILE=10,sT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sT.DEFAULT=new sT(0x2800000,sT.DEFAULT_COLLECTION_PERCENTILE,sT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sT.DISABLED=new sT(-1,0,0);class sS{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Xn={}}static wt(e,t,n,r){return V(""!==e.uid,64387),new sS(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return sA(e).ee({index:e4,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=t$(e,te),s=sA(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;V("number"==typeof a,49019);let f=new r2(a,t,n,r),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>iL(o.yt,e)),d=f.mutations.map(e=>iL(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),m=[],p=new t0((e,t)=>Z(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(u=this.userId,h=e.key.path,[u,eZ(h),a]);p=p.add(e.key.path.popLast()),m.push(s.put(g)),m.push(i.put(t,e9))}return p.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Xn[a]=f.keys()}),eO.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return sA(e).get(t).next(e=>e?(V(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),iX(this.serializer,e)):null)}er(e,t){return this.Xn[t]?eO.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Xn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return sA(e).ee({index:e4,range:r},(e,t,r)=>{t.userId===this.userId&&(V(t.batchId>=n,47524,{tr:n}),i=iX(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return sA(e).ee({index:e4,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return sA(e).J(e4,t).next(e=>e.map(e=>iX(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,eZ(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return t$(e,te).ee({range:r},(n,r,s)=>{let[a,o,l]=n,u=e0(o);if(a===this.userId&&t.path.isEqual(u))return sA(e).get(l).next(e=>{if(!e)throw L(61480,{nr:n,batchId:l});V(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(iX(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new t0(Z),r=[];return t.forEach(t=>{let i=[this.userId,eZ(t.path)],s=IDBKeyRange.lowerBound(i),a=t$(e,te).ee({range:s},(e,r,i)=>{let[s,a,o]=e,l=e0(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),eO.waitFor(r).next(()=>this.rr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,eZ(n)],s=IDBKeyRange.lowerBound(i),a=new t0(Z);return t$(e,te).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=e0(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.rr(e,a))}rr(e,t){let n=[],r=[];return t.forEach(t=>{r.push(sA(e).get(t).next(e=>{if(null===e)throw L(35274,{batchId:t});V(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(iX(this.serializer,e))}))}),eO.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return sE(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),eO.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eO.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return t$(e,te).ee({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=e0(e[1]);r.push(t)}else n.done()}).next(()=>{V(0===r.length,56720,{sr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return sx(e,this.userId,t)}_r(e){return t$(e,e6).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sx(e,t,n){let r=[t,eZ(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return t$(e,te).ee({range:s,X:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function sA(e){return t$(e,e3)}class sC{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new sC(0)}static cr(){return new sC(-1)}}class sD{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{let n=new sC(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(e=>eb.fromTimestamp(new ev(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.lr(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>t$(e,tu).delete(t.targetId)).next(()=>this.lr(e)).next(t=>(V(t.targetCount>0,8065),t.targetCount-=1,this.hr(e,t)))}removeTargets(e,t,n){let r=0,i=[];return t$(e,tu).ee((s,a)=>{let o=iY(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>eO.waitFor(i)).next(()=>r)}forEachTarget(e,t){return t$(e,tu).ee((e,n)=>{t(iY(n))})}lr(e){return t$(e,ty).get(tp).next(e=>(V(null!==e,2888),e))}hr(e,t){return t$(e,ty).put(tp,t)}Pr(e,t){return t$(e,tu).put(iZ(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next(e=>e.targetCount)}getTargetData(e,t){let n=n8(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return t$(e,tu).ee({range:r,index:th},(e,n,r)=>{let s=iY(n);n4(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=sN(e);return t.forEach(t=>{let s=eZ(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),eO.waitFor(r)}removeMatchingKeys(e,t,n){let r=sN(e);return eO.forEach(t,t=>{let i=eZ(t.path);return eO.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=sN(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=sN(e),i=rx();return r.ee({range:n,X:!0},(e,t,n)=>{let r=new el(e0(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=eZ(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return sN(e).ee({index:tg,X:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}At(e,t){return t$(e,tu).get(t).next(e=>e?iY(e):null)}}function sN(e){return t$(e,td)}let sk="LruGarbageCollector";function sR([e,t],[n,r]){let i=Z(e,n);return 0===i?Z(t,r):i}class sM{constructor(e){this.Ir=e,this.buffer=new t0(sR),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>sR(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sO{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){R(sk,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eq(e)?R(sk,"Ignoring IndexedDB error during garbage collection: ",e):await eM(e)}await this.Vr(3e5)})}}class sP{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eO.resolve(eW.ce);let n=new sM(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector","Garbage collection skipped; disabled"),eO.resolve(sI)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sI):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),N()<=v.LogLevel.DEBUG&&R("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),eO.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class sL{constructor(e,t){this.db=e,this.garbageCollector=new sP(this,t)}gr(e){let t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(e,n)=>t(n))}addReference(e,t,n){return sF(e,n)}removeReference(e,t,n){return sF(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return sF(e,t)}br(e,t){let n;return n=!1,t$(e,e6).te(r=>sx(e,r,t).next(e=>(e&&(n=!0),eO.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Sr(e,(s,a)=>{if(a<=t){let t=this.br(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,eb.min()),sN(e).delete([0,eZ(s.path)])))});r.push(t)}}).next(()=>eO.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return sF(e,t)}Sr(e,t){let n=sN(e),r,i=eW.ce;return n.ee({index:tg},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==eW.ce&&t(new el(e0(r)),i),i=a,r=s):i=eW.ce}).next(()=>{i!==eW.ce&&t(new el(e0(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sF(e,t){var n;return sN(e).put((n=e.currentSequenceNumber,{targetId:0,path:eZ(t.path),sequenceNumber:n}))}class sV{constructor(){this.changes=new rw(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nF.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?eO.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sU{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return t$(e,tt).put(n)}removeEntry(e,t,n){let r;return t$(e,tt).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],iH(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Dr(e,n)))}getEntry(e,t){let n=nF.newInvalidDocument(t);return t$(e,tt).ee({index:tr,range:IDBKeyRange.only(sq(t))},(e,r)=>{n=this.Cr(t,r)}).next(()=>n)}vr(e,t){let n={size:0,document:nF.newInvalidDocument(t)};return t$(e,tt).ee({index:tr,range:IDBKeyRange.only(sq(t))},(e,r)=>{n={document:this.Cr(t,r),size:s_(r)}}).next(()=>n)}getEntries(e,t){let n=rv;return this.Fr(e,t,(e,t)=>{let r=this.Cr(e,t);n=n.insert(e,r)}).next(()=>n)}Mr(e,t){let n=rv,r=new tX(el.comparator);return this.Fr(e,t,(e,t)=>{let i=this.Cr(e,t);n=n.insert(e,i),r=r.insert(e,s_(t))}).next(()=>({documents:n,Or:r}))}Fr(e,t,n){if(t.isEmpty())return eO.resolve();let r=new t0(sz);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(sq(r.first()),sq(r.last())),s=r.getIterator(),a=s.getNext();return t$(e,tt).ee({index:tr,range:i},(e,t,r)=>{let i=el.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>sz(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.j(sq(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),iH(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return t$(e,tt).J(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let n=rv;for(let i of e){let e=this.Cr(el.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(rm(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=rv,s=sj(t,n),a=sj(t,eD.max());return t$(e,tt).ee({index:ts,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.Cr(el.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new sB(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return t$(e,to).get(tl).next(e=>(V(!!e,20021),e))}Dr(e,t){return t$(e,to).put(tl,t)}Cr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=iP(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=el.fromSegments(t.noDocument.path),n=iJ(t.noDocument.readTime);r=nF.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return L(56709);{let e=el.fromSegments(t.unknownDocument.path),n=iJ(t.unknownDocument.version);r=nF.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new ev((n=t.readTime)[0],n[1]),eb.fromTimestamp(i))),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(eb.min())))return e}return nF.newInvalidDocument(e)}}class sB extends sV{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new rw(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new t0((e,t)=>Z(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=iQ(this.Nr.serializer,s);r=r.add(i.path.popLast());let l=s_(o);n+=l-a.size,t.push(this.Nr.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=iQ(this.Nr.serializer,s.convertToNoDocument(eb.min()));t.push(this.Nr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Nr.updateMetadata(e,n)),eO.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(e=>(this.Br.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:e,Or:t})=>(t.forEach((t,n)=>{this.Br.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function sq(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sj(e,t){let n=t.documentKey.path.toArray();return[e,iH(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function sz(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Z(n[e],r[e]))return i;return(i=Z(n.length,r.length))||(i=Z(n[n.length-2],r[r.length-2]))||Z(n[n.length-1],r[r.length-1])}class sG{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sK{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&rQ(n.mutation,e,t5.empty(),ev.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rx()).next(()=>t))}getLocalViewOfDocuments(e,t,n=rx()){let r=rE();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=rI();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=rE();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,rx()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=rv,s=rE(),a=rE();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof rJ)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),rQ(a.mutation,t,a.mutation.getFieldMask(),ev.now())):s.set(t.key,t5.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new sG(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let n=rE(),r=new tX((e,t)=>e-t),i=rx();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||t5.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||rx()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=rE();l.forEach(e=>{if(!i.has(e)){let r=r$(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eO.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return el.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):rs(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):eO.resolve(rE()),a=-1,o=i;return s.next(t=>eO.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?eO.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,rx())).next(e=>({batchId:a,changes:rT(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new el(t)).next(e=>{let t=rI();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=rI();return this.indexManager.getCollectionParents(e,i).next(a=>eO.forEach(a,a=>{let o=new rn(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,nF.newInvalidDocument(r)))});let n=rI();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&rQ(s.mutation,r,t5.empty(),ev.now()),rm(t,r)&&(n=n.insert(e,r))}),n})}}class s${constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return eO.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:i_(t.createTime)}),eO.resolve()}getNamedQuery(e,t){return eO.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:t.name,query:i0(t.bundledQuery),readTime:i_(t.readTime)}),eO.resolve()}}class sQ{constructor(){this.overlays=new tX(el.comparator),this.qr=new Map}getOverlay(e,t){return eO.resolve(this.overlays.get(t))}getOverlays(e,t){let n=rE();return eO.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),eO.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),eO.resolve()}getOverlaysForCollection(e,t,n){let r=rE(),i=t.length+1,s=new el(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return eO.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new tX((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=rE(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=rE(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return eO.resolve(a)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new r6(t,n));let i=this.qr.get(t);void 0===i&&(i=rx(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class sH{constructor(){this.sessionToken=t8.EMPTY_BYTE_STRING}getSessionToken(e){return eO.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eO.resolve()}}class sW{constructor(){this.Qr=new t0(sJ.$r),this.Ur=new t0(sJ.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new sJ(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new sJ(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new el(new es([])),n=new sJ(t,e),r=new sJ(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new el(new es([])),n=new sJ(t,e),r=new sJ(t,e+1),i=rx();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sJ(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sJ{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return el.comparator(e.key,t.key)||Z(e.Yr,t.Yr)}static Kr(e,t){return Z(e.Yr,t.Yr)||el.comparator(e.key,t.key)}}class sX{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new t0(sJ.$r)}checkEmpty(e){return eO.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new r2(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Zr=this.Zr.add(new sJ(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eO.resolve(s)}lookupMutationBatch(e,t){return eO.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),r=n<0?0:n;return eO.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return eO.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return eO.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new sJ(t,0),r=new sJ(t,1/0),i=[];return this.Zr.forEachInRange([n,r],e=>{let t=this.Xr(e.Yr);i.push(t)}),eO.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new t0(Z);return t.forEach(e=>{let t=new sJ(e,0),r=new sJ(e,1/0);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),eO.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;el.isDocumentKey(i)||(i=i.child(""));let s=new sJ(new el(i),0),a=new t0(Z);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Yr)),!0)},s),eO.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){V(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return eO.forEach(t.mutations,r=>{let i=new sJ(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new sJ(t,0),r=this.Zr.firstAfterOrEqual(n);return eO.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,eO.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sY{constructor(e){this.ri=e,this.docs=new tX(el.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return eO.resolve(n?n.document.mutableCopy():nF.newInvalidDocument(t))}getEntries(e,t){let n=rv;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():nF.newInvalidDocument(e))}),eO.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=rv,s=t.path,a=new el(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=eN(eC(a),n)||(r.has(a.key)||rm(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eO.resolve(i)}getAllFromCollectionGroup(e,t,n,r){L(9500)}ii(e,t){return eO.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sZ(this)}getSize(e){return eO.resolve(this.size)}}class sZ extends sV{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),eO.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class s0{constructor(e){this.persistence=e,this.si=new rw(e=>n8(e),n4),this.lastRemoteSnapshotVersion=eb.min(),this.highestTargetId=0,this.oi=0,this._i=new sW,this.targetCount=0,this.ai=sC.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),eO.resolve()}getLastRemoteSnapshotVersion(e){return eO.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eO.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),eO.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),eO.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new sC(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,eO.resolve()}updateTargetData(e,t){return this.Pr(t),eO.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,eO.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),eO.waitFor(i).next(()=>r)}getTargetCount(e){return eO.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return eO.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),eO.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),eO.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),eO.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return eO.resolve(n)}containsKey(e,t){return eO.resolve(this._i.containsKey(t))}}class s1{constructor(e,t){this.ui={},this.overlays={},this.ci=new eW(0),this.li=!1,this.li=!0,this.hi=new sH,this.referenceDelegate=e(this),this.Pi=new s0(this),this.indexManager=new sm,this.remoteDocumentCache=new sY(e=>this.referenceDelegate.Ti(e)),this.serializer=new i$(t),this.Ii=new s$(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sQ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new sX(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){R("MemoryPersistence","Starting transaction:",e);let r=new s2(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return eO.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class s2 extends eR{constructor(e){super(),this.currentSequenceNumber=e}}class s5{constructor(e){this.persistence=e,this.Ri=new sW,this.Vi=null}static mi(e){return new s5(e)}get fi(){if(this.Vi)return this.Vi;throw L(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),eO.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),eO.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),eO.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eO.forEach(this.fi,n=>{let r=el.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,eb.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return eO.or([()=>eO.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class s6{constructor(e,t){this.persistence=e,this.pi=new rw(e=>eZ(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new sP(this,t)}static mi(e,t){return new s6(e,t)}Ei(){}di(e){return eO.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return eO.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?eO.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,eb.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),eO.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),eO.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),eO.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),eO.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(ny(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=na(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return ne(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,tH(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw L(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return eO.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return eO.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class s3{constructor(e){this.serializer=e}k(e,t,n,r){let i=new eL("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore(e2),e.createObjectStore(e6,{keyPath:"userId"}),e.createObjectStore(e3,{keyPath:e8,autoIncrement:!0}).createIndex(e4,e7,{unique:!0}),e.createObjectStore(te),s8(e),e.createObjectStore(e1));let s=eO.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(td),e.deleteObjectStore(tu),e.deleteObjectStore(ty),s8(e)),s=s.next(()=>{let e,t;return e=i.store(ty),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:eb.min().toTimestamp(),targetCount:0},e.put(tp,t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(e3).J().next(t=>{e.deleteObjectStore(e3),e.createObjectStore(e3,{keyPath:e8,autoIncrement:!0}).createIndex(e4,e7,{unique:!0});let n=i.store(e3),r=t.map(e=>n.put(e));return eO.waitFor(r)}))),s=s.next(()=>{e.createObjectStore(tb,{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.yi(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore(to),this.wi(i)))),n<7&&r>=7&&(s=s.next(()=>this.Si(i))),n<8&&r>=8&&(s=s.next(()=>this.bi(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.Di(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore(tI,{keyPath:"bundleId"}),e.createObjectStore(tT,{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(tM,{keyPath:tO})).createIndex(tP,tL,{unique:!1}),t.createIndex(tF,tV,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(tt,{keyPath:tn})).createIndex(tr,ti),t.createIndex(ts,ta)}).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(e1))),n<14&&r>=14&&(s=s.next(()=>this.Fi(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(tE,{keyPath:"indexId",autoIncrement:!0}).createIndex(t_,"collectionGroup",{unique:!1}),e.createObjectStore(tS,{keyPath:tx}).createIndex(tA,tC,{unique:!1}),e.createObjectStore(tD,{keyPath:tN}).createIndex(tk,tR,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(tS).clear()}).next(()=>{t.objectStore(tD).clear()})),n<17&&r>=17&&(s=s.next(()=>{e.createObjectStore(tU,{keyPath:"name"})})),n<18&&r>=18&&(0,b.isSafariOrWebkit)()&&(s=s.next(()=>{t.objectStore(tS).clear()}).next(()=>{t.objectStore(tD).clear()})),s}wi(e){let t=0;return e.store(e1).ee((e,n)=>{t+=s_(n)}).next(()=>{let n={byteSize:t};return e.store(to).put(tl,n)})}yi(e){let t=e.store(e6),n=e.store(e3);return t.J().next(t=>eO.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.J(e4,r).next(n=>eO.forEach(n,n=>{V(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let r=iX(this.serializer,n);return sE(e,t.userId,r).next(()=>{})}))}))}Si(e){let t=e.store(td),n=e.store(e1);return e.store(ty).get(tp).next(e=>{let r=[];return n.ee((n,i)=>{let s=new es(n),a=[0,eZ(s)];r.push(t.get(a).next(n=>n?eO.resolve():t.put({targetId:0,path:eZ(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eO.waitFor(r))})}bi(e,t){e.createObjectStore(tw,{keyPath:tv});let n=t.store(tw),r=new sp,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:eZ(r)})}};return t.store(e1).ee({X:!0},(e,t)=>i(new es(e).popLast())).next(()=>t.store(te).ee({X:!0},([e,t,n],r)=>i(e0(t).popLast())))}Di(e){let t=e.store(tu);return t.ee((e,n)=>{let r=iY(n),i=iZ(this.serializer,r);return t.put(i)})}Ci(e,t){let n=t.store(e1),r=[];return n.ee((e,n)=>{let i=t.store(tt),s=(n.document?new el(es.fromString(n.document.name).popFirst(5)):n.noDocument?el.fromSegments(n.noDocument.path):n.unknownDocument?el.fromSegments(n.unknownDocument.path):L(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>eO.waitFor(r))}Fi(e,t){let n=t.store(e3),r=new sU(this.serializer),i=new s1(s5.mi,this.serializer.yt);return n.J().next(e=>{let n=new Map;return e.forEach(e=>{let t=n.get(e.userId)??rx();iX(this.serializer,e).keys().forEach(e=>t=t.add(e)),n.set(e.userId,t)}),eO.forEach(n,(e,n)=>{let s=new A(n),a=i3.wt(this.serializer,s),o=i.getIndexManager(s);return new sK(r,sS.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new tK(t,eW.ce),e).next()})})}}function s8(e){e.createObjectStore(td,{keyPath:tf}).createIndex(tg,tm,{unique:!0}),e.createObjectStore(tu,{keyPath:"targetId"}).createIndex(th,tc,{unique:!0}),e.createObjectStore(ty)}let s4="IndexedDbPersistence",s7="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",s9="main";class ae{constructor(e,t,n,r,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=i,this.window=s,this.document=a,this.xi=l,this.Oi=u,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=-1/0,this.Qi=e=>Promise.resolve(),!ae.v())throw new q(B.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sL(this,r),this.$i=t+s9,this.serializer=new i$(o),this.Ui=new eF(this.$i,this.Ni,new s3(this.serializer)),this.hi=new i8,this.Pi=new sD(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new sU(this.serializer),this.Ii=new i6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,!1===u&&M(s4,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new q(B.FAILED_PRECONDITION,s7);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new eW(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>t$(e,tb).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(eq(e))return R(s4,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R(s4,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return t$(e,e2).get(e5).next(e=>eO.resolve(this.es(e)))}ts(e){return t$(e,tb).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,18e5)){this.qi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=t$(e,tb);return t.J().next(e=>{let n=this.ss(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return eO.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ki)for(let t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?eO.resolve(!0):t$(e,e2).get(e5).next(t=>{if(null!==t&&this.rs(t.leaseTimestampMs,5e3)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new q(B.FAILED_PRECONDITION,s7);return!1}}return!(!this.networkEnabled||!this.inForeground)||t$(e,tb).J().next(e=>void 0===this.ss(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&R(s4,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[e2,tb],e=>{let t=new tK(e,eW.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(e=>this.rs(e.updateTimeMs,t)&&!this.us(e.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>t$(e,tb).J().next(e=>this.ss(e,18e5).map(e=>e.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return sS.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new sv(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return i3.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){var r;let i;R(s4,"Starting transaction:",e);let s=18===(r=this.Ni)||17===r?tG:16===r||15===r?tz:14===r||13===r?tj:12===r?tq:11===r?tB:void L(60245);return this.Ui.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new tK(r,this.ci?this.ci.next():eW.ce),"readwrite-primary"===t?this.Hi(i).next(e=>!!e||this.Yi(i)).next(t=>{if(!t)throw M(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new q(B.FAILED_PRECONDITION,ek);return n(i)}).next(e=>this.Xi(i).next(()=>e)):this.Is(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Is(e){return t$(e,e2).get(e5).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,5e3)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new q(B.FAILED_PRECONDITION,s7)})}Xi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return t$(e,e2).put(e5,t)}static v(){return eF.v()}Zi(e){let t=t$(e,e2);return t.get(e5).next(e=>this.es(e)?(R(s4,"Releasing primary lease."),t.delete(e5)):eO.resolve())}rs(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(M(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground="visible"===this.document.visibilityState)}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){"function"==typeof this.window?.addEventListener&&(this.Bi=()=>{this.cs();let e=/(?:Version|Mobile)\/1[456]/;(0,b.isSafari)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{let t=null!==this.Ki?.getItem(this._s(e));return R(s4,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return M(s4,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){M("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch(e){}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function at(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class an{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=rx(),r=rx();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new an(e,t.fromCache,n,r)}}class ar{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ai{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,b.isSafari)()?8:eV((0,b.getUA)())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new ar;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(N()<=v.LogLevel.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",rg(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),eO.resolve()):(N()<=v.LogLevel.DEBUG&&R("QueryEngine","Query:",rg(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(N()<=v.LogLevel.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",rg(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ro(t))):eO.resolve())}ys(e,t){if(ri(t))return eO.resolve(null);let n=ro(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=ro(t=rc(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=rx(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,rc(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return ri(t)||r.isEqual(eb.min())?eO.resolve(null):this.ps.getDocuments(e,n).next(i=>{let s=this.Ds(t,i);return this.Cs(t,s,n,r)?eO.resolve(null):(N()<=v.LogLevel.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rg(t)),this.vs(e,s,t,eA(r,-1)).next(e=>e))})}Ds(e,t){let n=new t0(ry(e));return t.forEach((t,r)=>{rm(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return N()<=v.LogLevel.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",rg(t)),this.ps.getDocumentsMatchingQuery(e,t,eD.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let as="LocalStore";class aa{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new tX(Z),this.xs=new rw(e=>n8(e),n4),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sK(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function ao(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=rx();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function al(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function au(e,t,n){let r=rx(),i=rx();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=rv;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(eb.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):R(as,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{ks:r,qs:i}})}function ah(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Pi.getTargetData(n,t).next(i=>i?(r=i,eO.resolve(r)):e.Pi.allocateTargetId(n).next(i=>(r=new iK(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.Ms.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n})}async function ac(e,t,n){let r=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!eq(e))throw e;R(as,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(r.target)}function ad(e,t,n){let r=eb.min(),i=rx();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=ro(t),void 0!==(o=e.xs.get(a))?eO.resolve(e.Ms.get(o)):e.Pi.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?r:eb.min(),n?i:rx())).next(n=>(am(e,rp(t),n),{documents:n,Qs:i}))})}function af(e,t){let n=e.Pi,r=e.Ms.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.At(e,t).next(e=>e?e.target:null))}function ag(e,t){let n=e.Os.get(t)||eb.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.Ns.getAllFromCollectionGroup(r,t,eA(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(am(e,t,n),n))}function am(e,t,n){let r=e.Os.get(t)||eb.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}async function ap(e,t,n,r){let i=rx(),s=rv;for(let e of n){let n=t.$s(e.metadata.name);e.document&&(i=i.add(n));let r=t.Us(e);r.setReadTime(t.Ks(e.metadata.readTime)),s=s.insert(n,r)}let a=e.Ns.newChangeBuffer({trackRemovals:!0}),o=await ah(e,ro(rr(es.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>au(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Pi.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Pi.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.ks,n.qs)).next(()=>n.ks)))}async function ay(e,t,n=rx()){let r=await ah(e,ro(i0(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=i_(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Ii.saveNamedQuery(i,t);let a=r.withResumeToken(t8.EMPTY_BYTE_STRING,s);return e.Ms=e.Ms.insert(a.targetId,a),e.Pi.updateTargetData(i,a).next(()=>e.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Pi.addMatchingKeys(i,n,r.targetId)).next(()=>e.Ii.saveNamedQuery(i,t))})}let aw="firestore_clients";function av(e,t){return`${aw}_${e}_${t}`}let ab="firestore_mutations";function aI(e,t,n){let r=`${ab}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let aT="firestore_targets";function aE(e,t){return`${aT}_${e}_${t}`}let a_="SharedClientState";class aS{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Ws(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new q(r.error.code,r.error.message)),s?new aS(e,t,r.state,i):(M(a_,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ax{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ws(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new q(n.error.code,n.error.message)),i?new ax(e,n.state,r):(M(a_,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aA{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=rA;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=eY(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new aA(e,i):(M(a_,`Failed to parse client data for instance '${e}': ${t}`),null)}}class aC{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aC(t.clientId,t.onlineState):(M(a_,`Failed to parse online state: ${e}`),null)}}class aD{constructor(){this.activeTargetIds=rA}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class aN{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.Mi=t,this.persistenceKey=n,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new tX(Z),this.started=!1,this.Xs=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=av(this.persistenceKey,this.Js),this.no=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Zs=this.Zs.insert(this.Js,new aD),this.ro=RegExp(`^${aw}_${l}_([^_]*)$`),this.io=RegExp(`^${ab}_${l}_(\\d+)(?:_(.*))?$`),this.so=RegExp(`^${aT}_${l}_(\\d+)$`),this.oo=(a=this.persistenceKey,`firestore_online_state_${a}`),this._o=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Ts())){if(e===this.Js)continue;let t=this.getItem(av(this.persistenceKey,e));if(t){let n=aA.Ws(e,t);n&&(this.Zs=this.Zs.insert(n.clientId,n))}}this.ao();let e=this.storage.getItem(this.oo);if(e){let t=this.uo(e);t&&this.co(t)}for(let e of this.Xs)this.Ys(e);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,n){this.ho(e,t,n),this.Po(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(aE(this.persistenceKey,e));if(t){let r=ax.Ws(e,t);r&&(n=r.state)}}return t&&this.To.zs(e),this.ao(),n}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(aE(this.persistenceKey,e))}updateQueryState(e,t,n){this.Io(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Po(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return R(a_,"READ",e,t),t}setItem(e,t){R(a_,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){R(a_,"REMOVE",e),this.storage.removeItem(e)}Ys(e){if(e.storageArea===this.storage){if(R(a_,"EVENT",e.key,e.newValue),e.key===this.eo)return void M("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.ro.test(e.key)){if(null==e.newValue){let t=this.Ro(e.key);return this.Vo(t,null)}{let t=this.mo(e.key,e.newValue);if(t)return this.Vo(t.clientId,t)}}else if(this.io.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(this.so.test(e.key)){if(null!==e.newValue){let t=this.yo(e.key,e.newValue);if(t)return this.wo(t)}}else if(e.key===this.oo){if(null!==e.newValue){let t=this.uo(e.newValue);if(t)return this.co(t)}}else if(e.key===this.no){let t=function(e){let t=eW.ce;if(null!=e)try{let n=JSON.parse(e);V("number"==typeof n,30636,{So:e}),t=n}catch(e){M(a_,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==eW.ce&&this.sequenceNumberHandler(t)}else if(e.key===this._o){let t=this.bo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Do(e)))}}}else this.Xs.push(e)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,n){let r=new aS(this.currentUser,e,t,n),i=aI(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Gs())}Po(e){let t=aI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){let t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,n){let r=aE(this.persistenceKey,e),i=new ax(e,t,n);this.setItem(r,i.Gs())}Ao(e){let t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){let t=this.ro.exec(e);return t?t[1]:null}mo(e,t){let n=this.Ro(e);return aA.Ws(n,t)}fo(e,t){let n=this.io.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return aS.Ws(new A(i),r,t)}yo(e,t){let n=Number(this.so.exec(e)[1]);return ax.Ws(n,t)}uo(e){return aC.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);R(a_,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){let n=t?this.Zs.insert(e,t):this.Zs.remove(e),r=this.lo(this.Zs),i=this.lo(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Fo(s,a).then(()=>{this.Zs=n})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=rA;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class ak{constructor(){this.Mo=new aD,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new aD,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class aR{Oo(e){}shutdown(){}}let aM="ConnectivityMonitor";class aO{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(R(aM,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(R(aM,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aP=null;function aL(){return null===aP?aP=0x10000000+Math.round(0x80000000*Math.random()):aP++,"0x"+aP.toString(16)}let aF="RestConnection",aV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aU{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===nu?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){let s=aL(),a=this.zo(e,t.toUriEncodedString());R(aF,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,r,i);let{host:l}=new URL(a),u=(0,b.isCloudWorkstation)(l);return this.Jo(e,a,o,n,u).then(t=>(R(aF,`Received RPC '${e}' ${s}: `,t),t),t=>{throw O(aF,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+C,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=aV[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class aB{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let aq="WebChannelConnection";class aj extends aU{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,o){let l=aL();return new Promise((o,u)=>{let h=new r;h.setWithCredentials(!0),h.listenOnce(s.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case a.NO_ERROR:let t=h.getResponseJson();R(aq,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(t)),o(t);break;case a.TIMEOUT:R(aq,`RPC '${e}' ${l} timed out`),u(new q(B.DEADLINE_EXCEEDED,"Request time out"));break;case a.HTTP_ERROR:let n=h.getStatus();if(R(aq,`RPC '${e}' ${l} failed with status:`,n,"response text:",h.getResponseText()),n>0){let e=h.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(B).indexOf(e)>=0?e:B.UNKNOWN);u(new q(n,t.message))}else u(new q(B.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new q(B.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:e,streamId:l,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{R(aq,`RPC '${e}' ${l} completed.`)}});let c=JSON.stringify(i);R(aq,`RPC '${e}' ${l} sending request:`,i),h.send(t,"POST",c,n,15)})}T_(e,t,n){let r=aL(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=h(),d=u(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;void 0!==g&&(f.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;let m=s.join("");R(aq,`Creating RPC '${e}' stream ${r}: ${m}`,f);let p=a.createWebChannel(m,f);this.I_(p);let y=!1,w=!1,v=new aB({Yo:t=>{w?R(aq,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(y||(R(aq,`Opening RPC '${e}' stream ${r} transport.`),p.open(),y=!0),R(aq,`RPC '${e}' stream ${r} sending:`,t),p.send(t))},Zo:()=>p.close()}),b=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(p,i.EventType.OPEN,()=>{w||(R(aq,`RPC '${e}' stream ${r} transport opened.`),v.o_())}),b(p,i.EventType.CLOSE,()=>{w||(w=!0,R(aq,`RPC '${e}' stream ${r} transport closed`),v.a_(),this.E_(p))}),b(p,i.EventType.ERROR,t=>{w||(w=!0,O(aq,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),v.a_(new q(B.UNAVAILABLE,"The operation could not be completed")))}),b(p,i.EventType.MESSAGE,t=>{if(!w){let n=t.data[0];V(!!n,16349);let i=n?.error||n[0]?.error;if(i){R(aq,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=c[e];if(void 0!==t)return r7(t)}(t),s=i.message;void 0===n&&(n=B.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),w=!0,v.a_(new q(n,s)),p.close()}else R(aq,`RPC '${e}' stream ${r} received:`,n),v.u_(n)}}),b(d,l.STAT_EVENT,t=>{t.stat===o.PROXY?R(aq,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===o.NOPROXY&&R(aq,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.__()},0),v}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function az(){return"undefined"!=typeof window?window:null}function aG(){return"undefined"!=typeof document?document:null}function aK(e){return new ib(e,!0)}class a${constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&R("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let aQ="PersistentStream";class aH{constructor(e,t,n,r,i,s,a,o){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new a$(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===B.RESOURCE_EXHAUSTED?(M(t.toString()),M("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===B.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new q(B.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return R(aQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(R(aQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aW extends aH{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:L(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(V(void 0===i||"string"==typeof i,58123),t8.fromBase64String(i||"")):(V(void 0===i||i instanceof p.Buffer||i instanceof Uint8Array,16193),t8.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new ic(s,a,o,l&&new q(void 0===l.code?B.UNKNOWN:r7(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=iD(e,r.document.name),s=i_(r.document.updateTime),a=r.document.createTime?i_(r.document.createTime):eb.min(),o=new nL({mapValue:{fields:r.document.fields}}),l=nF.newFoundDocument(i,s,a,o);n=new iu(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=iD(e,r.document),s=r.readTime?i_(r.readTime):eb.min(),a=nF.newNoDocument(i,s);n=new iu([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=iD(e,r.document);n=new iu([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return L(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new r8(r,i);n=new ih(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return eb.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?eb.min():t.readTime?i_(t.readTime):eb.min()}(e);return this.listener.H_(t,n)}Y_(e){let t,n={};n.database=iR(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=n7(r)?{documents:iV(e,r)}:{query:iU(e,r).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=iE(e,t.resumeToken);let r=iI(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(eb.min())>0){n.readTime=iT(e,t.snapshotVersion.toTimestamp());let r=iI(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.q_(n)}Z_(e){let t={};t.database=iR(this.serializer),t.removeTarget=e,this.q_(t)}}class aJ extends aH{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return V(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,V(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;V(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(V(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?i_(e.updateTime):i_(n)).isEqual(eb.min())&&(t=i_(n)),new rj(t,e.transformResults||[])})):[]),i=i_(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=iR(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>iL(this.serializer,e))};this.q_(t)}}class aX{}class aY extends aX{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new q(B.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,ix(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new q(B.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Ho(e,ix(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new q(B.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class aZ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(M(t),this.aa=!1):R("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let a0="RemoteStore";class a1{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{oe(this)&&(R(a0,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await a5(e),e.Ra.set("Unknown"),e.Ea.delete(4),await a2(e)}(this))})}),this.Ra=new aZ(n,r)}}async function a2(e){if(oe(e))for(let t of e.da)await t(!0)}async function a5(e){for(let t of e.da)await t(!1)}function a6(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),a9(e)?a7(e):op(e).O_()&&a8(e,t))}function a3(e,t){let n=op(e);e.Ia.delete(t),n.O_()&&a4(e,t),0===e.Ia.size&&(n.O_()?n.L_():oe(e)&&e.Ra.set("Unknown"))}function a8(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(eb.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}op(e).Y_(t)}function a4(e,t){e.Va.Ue(t),op(e).Z_(t)}function a7(e){e.Va=new ig({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),op(e).start(),e.Ra.ua()}function a9(e){return oe(e)&&!op(e).x_()&&e.Ia.size>0}function oe(e){return 0===e.Ea.size}async function ot(e){e.Ra.set("Online")}async function on(e){e.Ia.forEach((t,n)=>{a8(e,t)})}async function or(e,t){e.Va=void 0,a9(e)?(e.Ra.ha(t),a7(e)):e.Ra.set("Unknown")}async function oi(e,t,n){if(e.Ra.set("Online"),t instanceof ic&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){R(a0,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await os(e,n)}else if(t instanceof iu?e.Va.Ze(t):t instanceof ih?e.Va.st(t):e.Va.tt(t),!n.isEqual(eb.min()))try{let t,r=await al(e.localStore);n.compareTo(r)>=0&&await ((t=e.Va.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(t8.EMPTY_BYTE_STRING,r.snapshotVersion)),a4(e,t);let i=new iK(r.target,t,n,r.sequenceNumber);a8(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){R(a0,"Failed to raise snapshot:",t),await os(e,t)}}async function os(e,t,n){if(!eq(t))throw t;e.Ea.add(1),await a5(e),e.Ra.set("Offline"),n||(n=()=>al(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{R(a0,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await a2(e)})}function oa(e,t){return t().catch(n=>os(e,n,t))}async function oo(e){var t;let n=oy(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;oe(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=oy(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await os(e,t)}ol(e)&&ou(e)}function ol(e){return oe(e)&&!oy(e).x_()&&e.Ta.length>0}function ou(e){oy(e).start()}async function oh(e){oy(e).ra()}async function oc(e){let t=oy(e);for(let n of e.Ta)t.ea(n.mutations)}async function od(e,t,n){let r=e.Ta.shift(),i=r5.from(r,t,n);await oa(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await oo(e)}async function of(e,t){t&&oy(e).X_&&await async function(e,t){var n;if(r4(n=t.code)&&n!==B.ABORTED){let n=e.Ta.shift();oy(e).B_(),await oa(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await oo(e)}}(e,t),ol(e)&&ou(e)}async function og(e,t){e.asyncQueue.verifyOperationInProgress(),R(a0,"RemoteStore received new credentials");let n=oe(e);e.Ea.add(3),await a5(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await a2(e)}async function om(e,t){t?(e.Ea.delete(2),await a2(e)):t||(e.Ea.add(2),await a5(e),e.Ra.set("Unknown"))}function op(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Xo:ot.bind(null,e),t_:on.bind(null,e),r_:or.bind(null,e),H_:oi.bind(null,e)},t.sa(),e.ma=new aW(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.B_(),a9(e)?a7(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function oy(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Xo:()=>Promise.resolve(),t_:oh.bind(null,e),r_:of.bind(null,e),ta:oc.bind(null,e),na:od.bind(null,e)},t.sa(),e.fa=new aJ(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.fa.B_(),await oo(e)):(await e.fa.stop(),e.Ta.length>0&&(R(a0,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ow{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new j,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new ow(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new q(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ov(e,t){if(M("AsyncQueue",`${t}: ${e}`),eq(e))return new q(B.UNAVAILABLE,`${t}: ${e}`);throw e}class ob{static emptySet(e){return new ob(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||el.comparator(t.key,n.key):(e,t)=>el.comparator(e.key,t.key),this.keyedMap=rI(),this.sortedSet=new tX(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ob)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new ob;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class oI{constructor(){this.ga=new tX(el.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):L(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class oT{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new oT(e,t,ob.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class oE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class o_{constructor(){this.queries=oS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new q(B.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=oS(),t.forEach((t,n)=>{for(let t of n.Sa)t.onError(e)})}}function oS(){return new rw(e=>rf(e),rd)}async function ox(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new oE,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=ov(n,`Initialization of query '${rg(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&oN(e)}async function oA(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=+!t.Da():!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function oC(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(r)&&(n=!0);i.wa=r}}n&&oN(e)}function oD(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Sa)e.onError(n);e.queries.delete(t)}function oN(e){e.Ca.forEach(e=>{e.next()})}(g=f||(f={})).Ma="default",g.Cache="cache";class ok{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new oT(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=oT.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==f.Cache}}class oR{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}class oM{constructor(e){this.serializer=e}$s(e){return iD(this.serializer,e)}Us(e){return e.metadata.exists?iP(this.serializer,e.document,!1):nF.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return i_(e)}}class oO{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=oP(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;let n=es.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,n=new oM(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.$s(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||rx()).add(e);t.set(n,r)}}return t}async ja(e){let t=await ap(e,new oM(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(let t of this.Ka)await ay(e,t,n.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function oP(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class oL{constructor(e){this.key=e}}class oF{constructor(e){this.key=e}}class oV{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=rx(),this.mutatedKeys=rx(),this.eu=ry(e),this.tu=new ob(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new oI,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=rm(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Rt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let a=t&&!r?this._u():[],o=0===this.Xa.size&&this.current&&!r?1:0,l=o!==this.Za;return(this.Za=o,0!==s.length||l)?{snapshot:new oT(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new oI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=rx(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new oF(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new oL(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=rx();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return oT.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let oU="SyncEngine";class oB{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class oq{constructor(e){this.key=e,this.hu=!1}}class oj{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new rw(e=>rf(e),rd),this.Iu=new Map,this.Eu=new Set,this.du=new tX(el.comparator),this.Au=new Map,this.Ru=new sW,this.Vu={},this.mu=new Map,this.fu=sC.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function oz(e,t,n=!0){let r,i=lh(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await oK(i,t,n,!0),r}async function oG(e,t){let n=lh(e);await oK(n,t,!0,!1)}async function oK(e,t,n,r){let i,s=await ah(e.localStore,ro(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await o$(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&a6(e.remoteStore,s),i}async function o$(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await ad(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return o8(e,t.targetId,o.au),o.snapshot})(e,t,n,r);let s=await ad(e.localStore,t,!0),a=new oV(t,s.Qs),o=a.ru(s.documents),l=il.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);o8(e,n,u.au);let h=new oB(t,n,a);return e.Tu.set(t,h),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}async function oQ(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!rd(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await ac(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&a3(e.remoteStore,r.targetId),o6(e,r.targetId)}).catch(eM)):(o6(e,r.targetId),await ac(e.localStore,r.targetId,!0))}async function oH(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),a3(e.remoteStore,n.targetId))}async function oW(e,t,n){let r=lc(e);try{var i,s;let e,a,o,l,u,h=await (i=r.localStore,o=ev.now(),l=t.reduce((e,t)=>e.add(t.key),rx()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=rv,s=rx();return i.Ns.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=rR(r.transform,e||null);null!=i&&(null===n&&(n=nL.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new rJ(n.key,t,function e(t){let n=[];return tH(t.fields,(t,r)=>{let i=new eo([t]);if(nD(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new t5(n)}(t.value.mapValue),rz.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{a=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:rT(e)})));r.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=r.Vu[r.currentUser.toKey()])||(u=new tX(Z)),u=u.insert(s,n),r.Vu[r.currentUser.toKey()]=u,await o7(r,h.changes),await oo(r.remoteStore)}catch(t){let e=ov(t,"Failed to persist write");n.reject(e)}}async function oJ(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.Ms,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(t8.EMPTY_BYTE_STRING,eb.min()).withLastLimboFreeSnapshotVersion(eb.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.Pi.updateTargetData(e,h))});let o=rv,l=rx();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(au(e,s,t.documentUpdates).next(e=>{o=e.ks,l=e.qs})),!r.isEqual(eb.min())){let t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return eO.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.Ms=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(V(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?V(r.hu,14607):t.removedDocuments.size>0&&(V(r.hu,42227),r.hu=!1))}),await o7(e,s,t)}catch(e){await eM(e)}}function oX(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.va(t)&&(n=!0)}),n&&oN(r),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function oY(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new tX(el.comparator);n=n.insert(i,nF.newNoDocument(i,eb.min()));let r=rx().add(i),s=new io(eb.min(),new Map,new tX(Z),n,r);await oJ(e,s),e.du=e.du.remove(i),e.Au.delete(t),o4(e)}else await ac(e.localStore,t,!1).then(()=>o6(e,t,n)).catch(eM)}async function oZ(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=eO.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);V(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rx();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));o5(e,r,null),o2(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await o7(e,i)}catch(e){await eM(e)}}async function o0(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(V(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));o5(e,t,n),o2(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await o7(e,i)}catch(e){await eM(e)}}async function o1(e,t){var n;oe(e.remoteStore)||R(oU,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.mu.get(r)||[];i.push(t),e.mu.set(r,i)}catch(n){let e=ov(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function o2(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function o5(e,t,n){let r=e.Vu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Vu[e.currentUser.toKey()]=r}}function o6(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||o3(e,t)})}function o3(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(a3(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),o4(e))}function o8(e,t,n){for(let r of n)r instanceof oL?(e.Ru.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(R(oU,"New document in limbo: "+n),e.Eu.add(r),o4(e))}(e,r)):r instanceof oF?(R(oU,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||o3(e,r.key)):L(19791,{wu:r})}function o4(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new el(es.fromString(t)),r=e.fu.next();e.Au.set(r,new oq(n)),e.du=e.du.insert(n,r),a6(e.remoteStore,new iK(ro(rr(n.path)),r,"TargetPurposeLimboResolution",eW.ce))}}async function o7(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=an.As(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>eO.forEach(t,t=>eO.forEach(t.Es,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>eO.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!eq(e))throw e;R(as,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function o9(e,t){if(!e.currentUser.isEqual(t)){R(oU,"User change. New user:",t.toKey());let n=await ao(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new q(B.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await o7(e,n.Ls)}}function le(e,t){let n=e.Au.get(t);if(n&&n.hu)return rx().add(n.key);{let n=rx(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}async function lt(e,t){let n=await ad(e.localStore,t.query,!0),r=t.view.cu(n);return e.isPrimaryClient&&o8(e,t.targetId,r.au),r}async function ln(e,t){return ag(e.localStore,t).then(t=>o7(e,t))}async function lr(e,t,n,r){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.er(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):eO.resolve(null))));null!==o?("pending"===n?await oo(e.remoteStore):"acknowledged"===n||"rejected"===n?(o5(e,t,r||null),o2(e,t),s=e.localStore,s.mutationQueue.ir(t)):L(6720,"Unknown batchState",{Su:n}),await o7(e,o)):R(oU,"Cannot apply mutation batch with id: "+t)}async function li(e,t){if(lh(e),lc(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await ls(e,t.toArray());for(let t of(e.gu=!0,await om(e.remoteStore,!0),n))a6(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],n=Promise.resolve();e.Iu.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(o6(e,i),ac(e.localStore,i,!0))),a3(e.remoteStore,i)}),await n,await ls(e,t),e.Au.forEach((t,n)=>{a3(e.remoteStore,n)}),e.Ru.Jr(),e.Au=new Map,e.du=new tX(el.comparator),e.gu=!1,await om(e.remoteStore,!1)}}async function ls(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.Iu.get(n);if(s&&0!==s.length)for(let n of(t=await ah(e.localStore,ro(s[0])),s)){let t=e.Tu.get(n),r=await lt(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await af(e.localStore,n);t=await ah(e.localStore,r),await o$(e,la(r),n,!1,t.resumeToken)}r.push(t)}return e.Pu.H_(i),r}function la(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new rn(t,n,r,i,s,"F",e.startAt,e.endAt)}function lo(e){return e.localStore.persistence.Ts()}async function ll(e,t,n,r){if(e.gu)return void R(oU,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await ag(e.localStore,rp(i[0])),s=io.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,t8.EMPTY_BYTE_STRING);await o7(e,r,s);break}case"rejected":await ac(e.localStore,t,!0),o6(e,t,r);break;default:L(64155,n)}}async function lu(e,t,n){let r=lh(e);if(r.gu){for(let e of t){if(r.Iu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){R(oU,"Adding an already active target "+e);continue}let t=await af(r.localStore,e),n=await ah(r.localStore,t);await o$(r,la(t),n.targetId,!1,n.resumeToken),a6(r.remoteStore,n)}for(let e of n)r.Iu.has(e)&&await ac(r.localStore,e,!1).then(()=>{a3(r.remoteStore,e),o6(r,e)}).catch(eM)}}function lh(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=oJ.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=le.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oY.bind(null,e),e.Pu.H_=oC.bind(null,e.eventManager),e.Pu.yu=oD.bind(null,e.eventManager),e}function lc(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=oZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=o0.bind(null,e),e}class ld{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=aK(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new ai,new aa(t,n,e.initialUser,this.serializer)}Cu(e){return new s1(s5.mi,this.serializer)}Du(e){return new ak}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ld.provider={build:()=>new ld};class lf extends ld{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return V(this.persistence.referenceDelegate instanceof s6,46915),new sO(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?sT.withCacheSize(this.cacheSizeBytes):sT.DEFAULT;return new s1(e=>s6.mi(e,t),this.serializer)}}class lg extends ld{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await lc(this.xu.syncEngine),await oo(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,n;return t=this.persistence,n=new ai,new aa(t,n,e.initialUser,this.serializer)}Fu(e,t){return new sO(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let n=new eH(t,this.persistence);return new eQ(e.asyncQueue,n)}Cu(e){let t=at(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?sT.withCacheSize(this.cacheSizeBytes):sT.DEFAULT;return new ae(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,az(),aG(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new ak}}class lm extends lg{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof aN&&(this.sharedClientState.syncEngine={Co:lr.bind(null,t),vo:ll.bind(null,t),Fo:lu.bind(null,t),Ts:lo.bind(null,t),Do:ln.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async e=>{await li(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=az();if(!aN.v(t))throw new q(B.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=at(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new aN(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class lp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>oX(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=o9.bind(null,this.syncEngine),await om(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new o_}createDatastore(e){var t;let n=aK(e.databaseInfo.databaseId),r=new aj(e.databaseInfo);return t=e.authCredentials,new aY(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new a1(t,n,e.asyncQueue,e=>oX(this.syncEngine,e,0),aO.v()?new aO:new aR)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new oj(n,r,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){R(a0,"RemoteStore shutting down."),e.Ea.add(5),await a5(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function ly(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}lp.provider={build:()=>new lp};class lw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):M("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class lv{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new j,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.$a()?this.metadata.resolve(e.Qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.Qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.qu();if(null===e)return null;let t=this.Lu.decode(e),n=Number(t);return isNaN(n)&&this.Qu(`length string (${t}) is not valid number`),new oR(JSON.parse(await this.$u(n)),e.length+n)}Uu(){return this.buffer.findIndex(e=>123===e)}async qu(){for(;0>this.Uu()&&!await this.Ku(););if(0===this.buffer.length)return null;let e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Ku(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class lb{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.bu();if(!n||!n.$a())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.Qa)}`);this.metadata=n;do null!==(n=this.bu())&&this.elements.push(n);while(null!==n)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;let e=this.qu();return new oR(JSON.parse(this.$u(e)),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new q(B.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class lI{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new q(B.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>iC(e.serializer,t))},r=await e.Ho("BatchGetDocuments",e.serializer.databaseId,es.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,a,o,l,u,h=(n=e.serializer,"found"in t?(V(!!t.found,43571),t.found.name,t.found.updateTime,r=iD(n,t.found.name),s=i_(t.found.updateTime),a=t.found.createTime?i_(t.found.createTime):eb.min(),o=new nL({mapValue:{fields:t.found.fields}}),nF.newFoundDocument(r,s,a,o)):"missing"in t?(V(!!t.missing,3894),V(!!t.readTime,22933),l=iD(n,t.missing),u=i_(t.readTime),nF.newNoDocument(l,u)):L(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());V(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new r0(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=el.fromPath(t);this.mutations.push(new r1(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>iL(e.serializer,t))};await e.Go("Commit",e.serializer.databaseId,es.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw L(50498,{Gu:e.constructor.name});t=eb.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new q(B.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(eb.min())?rz.exists(!1):rz.updateTime(t):rz.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(eb.min()))throw new q(B.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rz.updateTime(t)}return rz.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class lT{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.zu=n.maxAttempts,this.M_=new a$(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{let e=new lI(this.datastore),t=this.Hu(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Yu(e)}))}).catch(e=>{this.Yu(e)})})}Hu(e){try{let t=this.updateFunction(e);return!eJ(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!r4(t)}return!1}}let lE="FirestoreClient";class l_{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=A.UNAUTHENTICATED,this.clientId=Y.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{R(lE,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(R(lE,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new j;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=ov(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function lS(e,t){e.asyncQueue.verifyOperationInProgress(),R(lE,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await ao(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function lx(e,t){e.asyncQueue.verifyOperationInProgress();let n=await lA(e);R(lE,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>og(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>og(t.remoteStore,n)),e._onlineComponents=t}async function lA(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){R(lE,"Using user provided OfflineComponentProvider");try{await lS(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===B.FAILED_PRECONDITION||t.code===B.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;O("Error using user provided cache. Falling back to memory cache: "+t),await lS(e,new ld)}}else R(lE,"Using default OfflineComponentProvider"),await lS(e,new lf(void 0));return e._offlineComponents}async function lC(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(R(lE,"Using user provided OnlineComponentProvider"),await lx(e,e._uninitializedComponentsProvider._online)):(R(lE,"Using default OnlineComponentProvider"),await lx(e,new lp))),e._onlineComponents}function lD(e){return lA(e).then(e=>e.persistence)}function lN(e){return lA(e).then(e=>e.localStore)}function lk(e){return lC(e).then(e=>e.remoteStore)}function lR(e){return lC(e).then(e=>e.syncEngine)}function lM(e){return lC(e).then(e=>e.datastore)}async function lO(e){let t=await lC(e),n=t.eventManager;return n.onListen=oz.bind(null,t.syncEngine),n.onUnlisten=oQ.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=oG.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=oH.bind(null,t.syncEngine),n}function lP(e,t,n={}){let r=new j;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lO(e),s=e.asyncQueue,a=new lw({next:e=>{a.Nu(),s.enqueueAndForget(()=>oA(i,o));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new q(B.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new q(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),ox(i,o=new ok(rr(t.path),a,{includeMetadataChanges:!0,qa:!0}))}),r.promise}function lL(e,t,n={}){let r=new j;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lO(e),s=e.asyncQueue,o=new ok(t,a=new lw({next:e=>{a.Nu(),s.enqueueAndForget(()=>oA(i,o)),e.fromCache&&"server"===n.source?r.reject(new q(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,qa:!0}),ox(i,o)}),r.promise}function lF(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let lV=new Map,lU="firestore.googleapis.com";class lB{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new q(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lU,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new q(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}eh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lF(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new q(B.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new q(B.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new q(B.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lq{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lB({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new q(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lB(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new G;switch(e.type){case"firstParty":return new H(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new q(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=lV.get(this))&&(R("ComponentProvider","Removing Datastore"),lV.delete(this),e.terminate()),Promise.resolve()}}function lj(e,t,n,r={}){e=em(e,lq);let i=(0,b.isCloudWorkstation)(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;i&&((0,b.pingServer)(`https://${o}`),(0,b.updateEmulatorBanner)("Firestore",!0)),s.host!==lU&&s.host!==o&&O("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:r};if(!(0,b.deepEqual)(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=A.MOCK_USER;else{t=(0,b.createMockUserToken)(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new q(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new A(i)}e._authCredentials=new K(new z(t,n))}}class lz{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new lz(this.firestore,e,this._query)}}class lG{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lK(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lG(this.firestore,e,this._key)}toJSON(){return{type:lG._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ew(t,lG._jsonSchema))return new lG(e,n||null,new el(es.fromString(t.referencePath)))}}lG._jsonSchemaVersion="firestore/documentReference/1.0",lG._jsonSchema={type:ey("string",lG._jsonSchemaVersion),referencePath:ey("string")};class lK extends lz{constructor(e,t,n){super(e,t,rr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new lG(this.firestore,null,new el(e))}withConverter(e){return new lK(this.firestore,e,this._path)}}function l$(e,t,...n){if(e=(0,b.getModularInstance)(e),eu("collection","path",t),e instanceof lq){let r=es.fromString(t,...n);return ed(r),new lK(e,null,r)}{if(!(e instanceof lG||e instanceof lK))throw new q(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(es.fromString(t,...n));return ed(r),new lK(e.firestore,null,r)}}function lQ(e,t){if(e=em(e,lq),eu("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new q(B.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new lz(e,null,new rn(es.emptyPath(),t))}function lH(e,t,...n){if(e=(0,b.getModularInstance)(e),1==arguments.length&&(t=Y.newId()),eu("doc","path",t),e instanceof lq){let r=es.fromString(t,...n);return ec(r),new lG(e,null,new el(r))}{if(!(e instanceof lG||e instanceof lK))throw new q(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(es.fromString(t,...n));return ec(r),new lG(e.firestore,e instanceof lK?e.converter:null,new el(r))}}function lW(e,t){return e=(0,b.getModularInstance)(e),t=(0,b.getModularInstance)(t),(e instanceof lG||e instanceof lK)&&(t instanceof lG||t instanceof lK)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function lJ(e,t){return e=(0,b.getModularInstance)(e),t=(0,b.getModularInstance)(t),e instanceof lz&&t instanceof lz&&e.firestore===t.firestore&&rd(e._query,t._query)&&e.converter===t.converter}let lX="AsyncQueue";class lY{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new a$(this,"async_queue_retry"),this._c=()=>{let e=aG();e&&R(lX,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=aG();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=aG();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new j;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!eq(e))throw e;R(lX,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,M("INTERNAL UNHANDLED ERROR: ",lZ(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=ow.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&L(47125,{Pc:lZ(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function lZ(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function l0(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class l1{constructor(){this._progressObserver={},this._taskCompletionResolver=new j,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class l2 extends lq{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new lY,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lY(e),this._firestoreClient=void 0,await e}}}function l5(e,t,n){n||(n=nu);let r=(0,y._getProvider)(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n}),i=r.getOptions(n);if((0,b.deepEqual)(i,t))return e;throw new q(B.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new q(B.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new q(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&(0,b.isCloudWorkstation)(t.host)&&(0,b.pingServer)(t.host),r.initialize({options:t,instanceIdentifier:n})}function l6(e,t){let n="object"==typeof e?e:(0,y.getApp)(),r="string"==typeof e?e:t||nu,i=(0,y._getProvider)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=(0,b.getDefaultEmulatorHostnameAndPort)("firestore");e&&lj(i,...e)}return i}function l3(e){if(e._terminated)throw new q(B.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||l8(e),e._firestoreClient}function l8(e){var t,n,r;let i,s=e._freezeSettings(),a=(t=e._databaseId,n=e._app?.options.appId||"",new nl(t,n,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,lF(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new l_(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&(r=e._componentsProvider,i=r?._online.build(),{_offline:r?._offline.build(i),_online:i}))}function l4(e,t){O("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings();return l9(e,lp.provider,{build:e=>new lg(e,n.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function l7(e){O("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();l9(e,lp.provider,{build:e=>new lm(e,t.cacheSizeBytes)})}function l9(e,t,n){if((e=em(e,l2))._firestoreClient||e._terminated)throw new q(B.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new q(B.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},l8(e)}function ue(e){if(e._initialized&&!e._terminated)throw new q(B.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new j;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!eF.v())return Promise.resolve();await eF.delete(e+s9)}(at(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function ut(e){var t;let n;return t=l3(e=em(e,l2)),n=new j,t.asyncQueue.enqueueAndForget(async()=>o1(await lR(t),n)),n.promise}function un(e){var t;return(t=l3(e=em(e,l2))).asyncQueue.enqueue(async()=>{let e=await lD(t),n=await lk(t);return e.setNetworkEnabled(!0),n.Ea.delete(0),a2(n)})}function ur(e){var t;return(t=l3(e=em(e,l2))).asyncQueue.enqueue(async()=>{let e=await lD(t),n=await lk(t);return e.setNetworkEnabled(!1),async function(e){e.Ea.add(0),await a5(e),e.Ra.set("Offline")}(n)})}function ui(e){return(0,y._removeServiceInstance)(e.app,"firestore",e._databaseId.database),e._delete()}function us(e,t){let n=l3(e=em(e,l2)),r=new l1;return function(e,t,n,r){var i;let s=(i=aK(t),new lv(function(e,t){if(e instanceof Uint8Array)return ly(e,void 0);if(e instanceof ArrayBuffer)return ly(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?ie().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r,i;let s,a=await t.getMetadata();if(await (r=e.localStore,s=i_(a.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Ii.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);n._updateProgress(oP(a));let o=new oO(a,t.serializer),l=await t.bu();for(;l;){let e=await o.Ga(l);e&&n._updateProgress(e),l=await t.bu()}let u=await o.ja(e.localStore);return await o7(e,u.Ha,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Ii.saveBundleMetadata(e,a))),n._completeWith(u.progress),Promise.resolve(u.Ja)}catch(e){return O(oU,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await lR(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,e._databaseId,t,r),r}function ua(e,t){var n;return(n=l3(e=em(e,l2)),n.asyncQueue.enqueue(async()=>{var e;return e=await lN(n),e.persistence.runTransaction("Get named query","readonly",n=>e.Ii.getNamedQuery(n,t))})).then(t=>t?new lz(e,null,t.query):null)}class uo{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class ul{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class uu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uu(t8.fromBase64String(e))}catch(e){throw new q(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new uu(t8.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:uu._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ew(e,uu._jsonSchema))return uu.fromBase64String(e.bytes)}}uu._jsonSchemaVersion="firestore/bytes/1.0",uu._jsonSchema={type:ey("string",uu._jsonSchemaVersion),bytes:ey("string")};class uh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new q(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new eo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function uc(){return new uh(er)}class ud{constructor(e){this._methodName=e}}class uf{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Z(this._lat,e._lat)||Z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:uf._jsonSchemaVersion}}static fromJSON(e){if(ew(e,uf._jsonSchema))return new uf(e.latitude,e.longitude)}}uf._jsonSchemaVersion="firestore/geoPoint/1.0",uf._jsonSchema={type:ey("string",uf._jsonSchemaVersion),latitude:ey("number"),longitude:ey("number")};class ug{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ug._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ew(e,ug._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new ug(e.vectorValues);throw new q(B.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ug._jsonSchemaVersion="firestore/vectorValue/1.0",ug._jsonSchema={type:ey("string",ug._jsonSchemaVersion),vectorValues:ey("object")};let um=/^__.*__$/;class up{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new rJ(e,this.data,this.fieldMask,t,this.fieldTransforms):new rW(e,this.data,t,this.fieldTransforms)}}class uy{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new rJ(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function uw(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ac:e})}}class uv{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new uv({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return uU(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(uw(this.Ac)&&um.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class ub{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||aK(e)}Cc(e,t,n,r=!1){return new uv({Ac:e,methodName:t,Dc:n,path:eo.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uI(e){let t=e._freezeSettings(),n=aK(e._databaseId);return new ub(e._databaseId,!!t.ignoreUndefinedProperties,n)}function uT(e,t,n,r,i,s={}){let a,o,l=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);uP("Data must be an object, but it was:",l,r);let u=uM(r,l);if(s.merge)a=new t5(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=uL(t,r,n);if(!l.contains(i))throw new q(B.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);uB(e,i)||e.push(i)}a=new t5(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new up(new nL(u),a,o)}class uE extends ud{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uE}}function u_(e,t,n){return new uv({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class uS extends ud{_toFieldTransform(e){return new rq(e.path,new rM)}isEqual(e){return e instanceof uS}}class ux extends ud{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=u_(this,e,!0),n=new rO(this.vc.map(e=>uR(e,t)));return new rq(e.path,n)}isEqual(e){return e instanceof ux&&(0,b.deepEqual)(this.vc,e.vc)}}class uA extends ud{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=u_(this,e,!0),n=new rL(this.vc.map(e=>uR(e,t)));return new rq(e.path,n)}isEqual(e){return e instanceof uA&&(0,b.deepEqual)(this.vc,e.vc)}}class uC extends ud{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){let t=new rV(e.serializer,rN(e.serializer,this.Fc));return new rq(e.path,t)}isEqual(e){return e instanceof uC&&this.Fc===e.Fc}}function uD(e,t,n,r){let i=e.Cc(1,t,n);uP("Data must be an object, but it was:",i,r);let s=[],a=nL.empty();return tH(r,(e,r)=>{let o=uV(t,e,n);r=(0,b.getModularInstance)(r);let l=i.yc(o);if(r instanceof uE)s.push(o);else{let e=uR(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new uy(a,new t5(s),i.fieldTransforms)}function uN(e,t,n,r,i,s){let a=e.Cc(1,t,n),o=[uL(t,r,n)],l=[i];if(s.length%2!=0)throw new q(B.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(uL(t,s[e])),l.push(s[e+1]);let u=[],h=nL.empty();for(let e=o.length-1;e>=0;--e)if(!uB(u,o[e])){let t=o[e],n=l[e];n=(0,b.getModularInstance)(n);let r=a.yc(t);if(n instanceof uE)u.push(t);else{let e=uR(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new uy(h,new t5(u),a.fieldTransforms)}function uk(e,t,n,r=!1){return uR(n,e.Cc(r?4:3,t))}function uR(e,t){if(uO(e=(0,b.getModularInstance)(e)))return uP("Unsupported field value:",t,e),uM(e,t);if(e instanceof ud)return function(e,t){if(!uw(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=uR(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){if(null===(e=(0,b.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return rN(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=ev.fromDate(e);return{timestampValue:iT(t.serializer,n)}}if(e instanceof ev){let n=new ev(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iT(t.serializer,n)}}if(e instanceof uf)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof uu)return{bytesValue:iE(t.serializer,e._byteString)};if(e instanceof lG){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:iS(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof ug)return{mapValue:{fields:{[nc]:{stringValue:ng},[nm]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return rC(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${eg(e)}`)}(e,t)}function uM(e,t){let n={};return tJ(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tH(e,(e,r)=>{let i=uR(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function uO(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ev||e instanceof uf||e instanceof uu||e instanceof lG||e instanceof ud||e instanceof ug)}function uP(e,t,n){if(!uO(n)||!ef(n)){let r=eg(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function uL(e,t,n){if((t=(0,b.getModularInstance)(t))instanceof uh)return t._internalPath;if("string"==typeof t)return uV(e,t);throw uU("Field path arguments must be of type string or ",e,!1,void 0,n)}let uF=RegExp("[~\\*/\\[\\]]");function uV(e,t,n){if(t.search(uF)>=0)throw uU(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new uh(...t.split("."))._internalPath}catch(r){throw uU(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function uU(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new q(B.INVALID_ARGUMENT,o+e+l)}function uB(e,t){return e.some(e=>e.isEqual(t))}class uq{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new lG(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new uj(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(uz("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uj extends uq{data(){return super.data()}}function uz(e,t){return"string"==typeof t?uV(e,t):t instanceof uh?t._internalPath:t._delegate._internalPath}function uG(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new q(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uK{}class u$ extends uK{}function uQ(e,t,...n){let r=[];for(let i of(t instanceof uK&&r.push(t),function(e){let t=e.filter(e=>e instanceof uJ).length,n=e.filter(e=>e instanceof uH).length;if(t>1||t>0&&n>0)throw new q(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class uH extends u${constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new uH(e,t,n)}_apply(e){let t=this._parse(e);return hr(e._query,t),new lz(e.firestore,e.converter,rh(e._query,t))}_parse(e){let t=uI(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new q(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){hn(a,s);let t=[];for(let n of a)t.push(ht(r,e,n));o={arrayValue:{values:t}}}else o=ht(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hn(a,s),o=uk(n,t,a,"in"===s||"not-in"===s);return nz.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function uW(e,t,n){let r=uz("where",e);return uH._create(r,t,n)}class uJ extends uK{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uJ(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:nG.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())hr(n,e),n=rh(n,e)}(e._query,t),new lz(e.firestore,e.converter,rh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function uX(...e){return e.forEach(e=>hi("or",e)),uJ._create("or",e)}function uY(...e){return e.forEach(e=>hi("and",e)),uJ._create("and",e)}class uZ extends u${constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new uZ(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new q(B.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new q(B.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new nq(t,n)}(e._query,this._field,this._direction);return new lz(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new rn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function u0(e,t="asc"){let n=uz("orderBy",e);return uZ._create(n,t)}class u1 extends u${constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new u1(e,t,n)}_apply(e){return new lz(e.firestore,e.converter,rc(e._query,this._limit,this._limitType))}}function u2(e){return ep("limit",e),u1._create("limit",e,"F")}function u5(e){return ep("limitToLast",e),u1._create("limitToLast",e,"L")}class u6 extends u${constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new u6(e,t,n)}_apply(e){var t;let n=he(e,this.type,this._docOrFields,this._inclusive);return new lz(e.firestore,e.converter,(t=e._query,new rn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}function u3(...e){return u6._create("startAt",e,!0)}function u8(...e){return u6._create("startAfter",e,!1)}class u4 extends u${constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new u4(e,t,n)}_apply(e){var t;let n=he(e,this.type,this._docOrFields,this._inclusive);return new lz(e.firestore,e.converter,(t=e._query,new rn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function u7(...e){return u4._create("endBefore",e,!1)}function u9(...e){return u4._create("endAt",e,!0)}function he(e,t,n,r){if(n[0]=(0,b.getModularInstance)(n[0]),n[0]instanceof uq)return function(e,t,n,r,i){if(!r)throw new q(B.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of ra(e))if(n.field.isKeyField())s.push(n_(t,r.key));else{let e=r.data.field(n.field);if(ns(e))throw new q(B.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new q(B.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new nV(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=uI(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new q(B.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new q(B.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!rs(e)&&-1!==l.indexOf("/"))throw new q(B.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(es.fromString(l));if(!el.isDocumentKey(n))throw new q(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new el(n);o.push(n_(t,i))}else{let e=uk(n,r,l);o.push(e)}}return new nV(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function ht(e,t,n){if("string"==typeof(n=(0,b.getModularInstance)(n))){if(""===n)throw new q(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rs(t)&&-1!==n.indexOf("/"))throw new q(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(es.fromString(n));if(!el.isDocumentKey(r))throw new q(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return n_(e,new el(r))}if(n instanceof lG)return n_(e,n._key);throw new q(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eg(n)}.`)}function hn(e,t){if(!Array.isArray(e)||0===e.length)throw new q(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hr(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new q(B.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new q(B.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function hi(e,t){if(!(t instanceof uH||t instanceof uJ))throw new q(B.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class hs{convertValue(e,t="none"){switch(ny(e)){case 0:return null;case 1:return e.booleanValue;case 2:return t9(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ne(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return tH(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new ug(e.fields?.[nm].arrayValue?.values?.map(e=>t9(e.doubleValue)))}convertGeoPoint(e){return new uf(t9(e.latitude),t9(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=na(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(no(e));default:return null}}convertTimestamp(e){let t=t7(e);return new ev(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=es.fromString(e);V(iG(n),9688,{name:e});let r=new nh(n.get(1),n.get(3)),i=new el(n.popFirst(5));return r.isEqual(t)||M(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ha(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class ho extends hs{constructor(e){super(),this.firestore=e}convertBytes(e){return new uu(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lG(this.firestore,null,t)}}function hl(e){return new uo("sum",uL("sum",e))}function hu(e){return new uo("avg",uL("average",e))}function hh(){return new uo("count")}function hc(e,t){return e instanceof uo&&t instanceof uo&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function hd(e,t){return lJ(e.query,t.query)&&(0,b.deepEqual)(e.data(),t.data())}let hf="NOT SUPPORTED";class hg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hm extends uq{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(uz("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(B.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=hm._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function hp(e,t,n){if(ew(t,hm._jsonSchema)){var r;if(t.bundle===hf)throw new q(B.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aK(e._databaseId),s=(r=t.bundle,new lb(r,i)),a=s.Wu(),o=new oO(s.getMetadata(),i);for(let e of a)o.Ga(e);let l=o.documents;if(1!==l.length)throw new q(B.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=iP(i,l[0].document),h=new el(es.fromString(t.bundleName));return new hm(e,new ho(e),h,u,new hg(!1,!1),n||null)}}hm._jsonSchemaVersion="firestore/documentSnapshot/1.0",hm._jsonSchema={type:ey("string",hm._jsonSchemaVersion),bundleSource:ey("string","DocumentSnapshot"),bundleName:ey("string"),bundle:ey("string")};class hy extends hm{data(e={}){return super.data(e)}}class hw{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new hg(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new hy(this._firestore,this._userDataWriter,n.key,n,new hg(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new hy(e._firestore,e._userDataWriter,n.doc.key,n.doc,new hg(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new hy(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hg(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(B.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=hw._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Y.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function hv(e,t,n){if(ew(t,hw._jsonSchema)){var r;if(t.bundle===hf)throw new q(B.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aK(e._databaseId),s=(r=t.bundle,new lb(r,i)),a=s.Wu(),o=new oO(s.getMetadata(),i);for(let e of a)o.Ga(e);if(1!==o.queries.length)throw new q(B.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=i0(o.queries[0].bundledQuery),u=o.documents,h=new ob;u.map(e=>{let t=iP(i,e.document);h=h.add(t)});let c=oT.fromInitialDocuments(l,h,rx(),!1,!1),d=new lz(e,n||null,l);return new hw(e,new ho(e),d,c)}}function hb(e,t){return e instanceof hm&&t instanceof hm?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hw&&t instanceof hw&&e._firestore===t._firestore&&lJ(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function hI(e){e=em(e,lG);let t=em(e.firestore,l2);return lP(l3(t),e._key).then(n=>hL(t,e,n))}hw._jsonSchemaVersion="firestore/querySnapshot/1.0",hw._jsonSchema={type:ey("string",hw._jsonSchemaVersion),bundleSource:ey("string","QuerySnapshot"),bundleName:ey("string"),bundle:ey("string")};class hT extends hs{constructor(e){super(),this.firestore=e}convertBytes(e){return new uu(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lG(this.firestore,null,t)}}function hE(e){var t;let n;e=em(e,lG);let r=em(e.firestore,l2),i=l3(r),s=new hT(r);return(t=e._key,n=new j,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new q(B.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=ov(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await lN(i),t,n)),n.promise).then(t=>new hm(r,s,e._key,t,new hg(null!==t&&t.hasLocalMutations,!0),e.converter))}function h_(e){e=em(e,lG);let t=em(e.firestore,l2);return lP(l3(t),e._key,{source:"server"}).then(n=>hL(t,e,n))}function hS(e){e=em(e,lz);let t=em(e.firestore,l2),n=l3(t),r=new hT(t);return uG(e._query),lL(n,e._query).then(n=>new hw(t,r,e,n))}function hx(e){var t;let n;e=em(e,lz);let r=em(e.firestore,l2),i=l3(r),s=new hT(r);return(t=e._query,n=new j,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await ad(e,t,!0),i=new oV(t,r.Qs),s=i.ru(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=ov(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await lN(i),t,n)),n.promise).then(t=>new hw(r,s,e,t))}function hA(e){e=em(e,lz);let t=em(e.firestore,l2),n=l3(t),r=new hT(t);return lL(n,e._query,{source:"server"}).then(n=>new hw(t,r,e,n))}function hC(e,t,n){e=em(e,lG);let r=em(e.firestore,l2),i=ha(e.converter,t,n);return hP(r,[uT(uI(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,rz.none())])}function hD(e,t,n,...r){e=em(e,lG);let i=em(e.firestore,l2),s=uI(i);return hP(i,[("string"==typeof(t=(0,b.getModularInstance)(t))||t instanceof uh?uN(s,"updateDoc",e._key,t,n,r):uD(s,"updateDoc",e._key,t)).toMutation(e._key,rz.exists(!0))])}function hN(e){return hP(em(e.firestore,l2),[new r0(e._key,rz.none())])}function hk(e,t){let n=em(e.firestore,l2),r=lH(e),i=ha(e.converter,t);return hP(n,[uT(uI(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,rz.exists(!1))]).then(()=>r)}function hR(e,...t){var n;let r,i,s,a,o;e=(0,b.getModularInstance)(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||l0(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(l0(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof lG)i=em(e.firestore,l2),s=rr(e._key.path),r={next:n=>{t[u]&&t[u](hL(i,e,n))},error:t[u+1],complete:t[u+2]};else{let n=em(e,lz);i=em(n.firestore,l2),s=n._query;let a=new hT(i);r={next:e=>{t[u]&&t[u](new hw(i,a,n,e))},error:t[u+1],complete:t[u+2]},uG(e._query)}return n=l3(i),o=new ok(s,a=new lw(r),h),n.asyncQueue.enqueueAndForget(async()=>ox(await lO(n),o)),()=>{a.Nu(),n.asyncQueue.enqueueAndForget(async()=>oA(await lO(n),o))}}function hM(e,t,...n){var r,i,s,a,o,l;let u=(0,b.getModularInstance)(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let n of["bundle","bundleName","bundleSource"]){if(!(n in e)){t.error=`snapshotJson missing required field: ${n}`;break}let r=e[n];if("string"!=typeof r){t.error=`snapshotJson field '${n}' must be a string.`;break}if(0===r.length){t.error=`snapshotJson field '${n}' cannot be an empty string.`;break}"bundle"===n?t.bundle=r:"bundleName"===n?t.bundleName=r:"bundleSource"===n&&(t.bundleSource=r)}return t}(t);if(h.error)throw new q(B.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof n[0]||l0(n[d])||(c=n[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof n[d]&&l0(n[d])){let e=n[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:n[d++],error:n[d++],complete:n[d++]};return r=c,i=a,s=n[d],t=!1,us(u,h.bundle).then(()=>ua(u,h.bundleName)).then(n=>{n&&!t&&(s&&n.withConverter(s),e=hR(n,r||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,r=null;if("object"==typeof n[d]&&l0(n[d])){let e=n[d++];r={next:e.next,error:e.error,complete:e.complete}}else r={next:n[d++],error:n[d++],complete:n[d++]};return a=c,o=r,l=n[d],t=!1,us(u,h.bundle).then(()=>{t||(e=hR(new lG(u,l||null,el.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new q(B.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function hO(e,t){var n;let r;return n=l3(e=em(e,l2)),r=new lw(l0(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lO(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lO(n),void e.Ca.delete(r)})}}function hP(e,t){var n;let r;return n=l3(e),r=new j,n.asyncQueue.enqueueAndForget(async()=>oW(await lR(n),t,r)),r.promise}function hL(e,t,n){let r=n.docs.get(t._key),i=new hT(e);return new hm(e,i,t._key,r,new hg(n.hasPendingWrites,n.fromCache),t.converter)}function hF(e){return hV(e,{count:hh()})}function hV(e,t){var n;let r,i=em(e.firestore,l2),s=l3(i),a=tW(t,(e,t)=>new r3(t,e.aggregateType,e._internalFieldPath));return(n=e._query,r=new j,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await lM(s);r.resolve(async function(e,t,n){let{request:r,gt:i,parent:s}=iB(e.serializer,rl(t),n);e.connection.$o||delete r.parent;let a=(await e.Ho("RunAggregationQuery",e.serializer.databaseId,s,r,1)).filter(e=>!!e.result);V(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,n,a))}catch(e){r.reject(e)}}),r.promise).then(t=>new ul(e,new hT(i),t))}class hU{constructor(e){this.kind="memory",this._onlineComponentProvider=lp.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new lf(void 0)}}toJSON(){return{kind:this.kind}}}class hB{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=hW(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class hq{constructor(){this.kind="memoryEager",this._offlineComponentProvider=ld.provider}toJSON(){return{kind:this.kind}}}class hj{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new lf(e)}}toJSON(){return{kind:this.kind}}}function hz(){return new hq}function hG(e){return new hj(e?.cacheSizeBytes)}function hK(e){return new hU(e)}function h$(e){return new hB(e)}class hQ{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lp.provider,this._offlineComponentProvider={build:t=>new lg(t,e?.cacheSizeBytes,this.forceOwnership)}}}class hH{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lp.provider,this._offlineComponentProvider={build:t=>new lm(t,e?.cacheSizeBytes)}}}function hW(e){return new hQ(e?.forceOwnership)}function hJ(){return new hH}let hX={maxAttempts:5};class hY{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=uI(e)}set(e,t,n){this._verifyNotCommitted();let r=hZ(e,this._firestore),i=ha(r.converter,t,n),s=uT(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,rz.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=hZ(e,this._firestore);return i="string"==typeof(t=(0,b.getModularInstance)(t))||t instanceof uh?uN(this._dataReader,"WriteBatch.update",s._key,t,n,r):uD(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,rz.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=hZ(e,this._firestore);return this._mutations=this._mutations.concat(new r0(t._key,rz.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new q(B.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hZ(e,t){if((e=(0,b.getModularInstance)(e)).firestore!==t)throw new q(B.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class h0{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=uI(e)}get(e){let t=hZ(e,this._firestore),n=new ho(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return L(24041);let r=e[0];if(r.isFoundDocument())return new uq(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new uq(this._firestore,n,t._key,null,t.converter);throw L(18433,{doc:r})})}set(e,t,n){let r=hZ(e,this._firestore),i=ha(r.converter,t,n),s=uT(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=hZ(e,this._firestore);return i="string"==typeof(t=(0,b.getModularInstance)(t))||t instanceof uh?uN(this._dataReader,"Transaction.update",s._key,t,n,r):uD(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=hZ(e,this._firestore);return this._transaction.delete(t._key),this}}class h1 extends h0{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=hZ(e,this._firestore),n=new hT(this._firestore);return super.get(e).then(e=>new hm(this._firestore,n,t._key,e._document,new hg(!1,!1),t.converter))}}function h2(e,t,n){var r,i;let s;e=em(e,l2);let a={...hX,...n};if(a.maxAttempts<1)throw new q(B.INVALID_ARGUMENT,"Max attempts must be at least 1");return r=l3(e),i=n=>t(new h1(e,n)),s=new j,r.asyncQueue.enqueueAndForget(async()=>{let e=await lM(r);new lT(r.asyncQueue,e,a,i,s).ju()}),s.promise}function h5(){return new uE("deleteField")}function h6(){return new uS("serverTimestamp")}function h3(...e){return new ux("arrayUnion",e)}function h8(...e){return new uA("arrayRemove",e)}function h4(e){return new uC("increment",e)}function h7(e){return new ug(e)}function h9(e){return l3(e=em(e,l2)),new hY(e,t=>hP(e,t))}function ce(e,t){let n=l3(e=em(e,l2));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return O("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new q(B.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=ct(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=uV("setIndexConfiguration",ct(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new eS(e,2)):"ASCENDING"===t.order?r.push(new eS(e,0)):"DESCENDING"===t.order&&r.push(new eS(e,1))}n.push(new eI(eI.UNKNOWN_ID,t,r,ex.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,e_,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>eO.waitFor(r)))})(await lN(n),r))}function ct(e,t){if("string"!=typeof e[t])throw new q(B.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class cn{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function cr(e){e=em(e,l2);let t=cl.get(e);if(t)return t;let n=l3(e);if("persistent"!==n._uninitializedComponentsProvider?._offline.kind)return null;let r=new cn(e);return cl.set(e,r),r}function ci(e){co(e,!0)}function cs(e){co(e,!1)}function ca(e){var t;(t=l3(e._firestore)).asyncQueue.enqueue(async()=>{var e;let n;return n=(e=await lN(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}).then(e=>R("deleting all persistent cache indexes succeeded")).catch(e=>O("deleting all persistent cache indexes failed",e))}function co(e,t){var n;(n=l3(e._firestore),n.asyncQueue.enqueue(async()=>{var e;return e=await lN(n),void(e.Fs.Vs=t)})).then(e=>R(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>O(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let cl=new WeakMap;function cu(e){let t=l3(em(e.firestore,l2)),n=t._onlineComponents?.datastore.serializer;return void 0===n?null:iU(n,ro(e._query)).ft}function ch(e,t){let n=tW(t,(e,t)=>new r3(t,e.aggregateType,e._internalFieldPath)),r=l3(em(e.firestore,l2)),i=r._onlineComponents?.datastore.serializer;return void 0===i?null:iB(i,rl(e._query),n,!0).request}class cc{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return cd.instance.onExistenceFilterMismatch(e)}}class cd{constructor(){this.Mc=new Map}static get instance(){return cf||function(e){if(r9)throw Error("a TestingHooksSpi instance is already set");r9=e}(cf=new cd),cf}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.Mc;return n.set(t,e),()=>n.delete(t)}}let cf=null;!function(e=!0){C=y.SDK_VERSION,(0,y._registerComponent)(new w.Component("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new l2(new $(t.getProvider("auth-internal")),new J(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new q(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nh(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,y.registerVersion)(S,x,void 0),(0,y.registerVersion)(S,x,"esm2020")}(),e.s(["AbstractUserDataWriter",()=>hs,"AggregateField",()=>uo,"AggregateQuerySnapshot",()=>ul,"Bytes",()=>uu,"CACHE_SIZE_UNLIMITED",()=>-1,"CollectionReference",()=>lK,"DocumentReference",()=>lG,"DocumentSnapshot",()=>hm,"FieldPath",()=>uh,"FieldValue",()=>ud,"Firestore",()=>l2,"FirestoreError",()=>q,"GeoPoint",()=>uf,"LoadBundleTask",()=>l1,"PersistentCacheIndexManager",()=>cn,"Query",()=>lz,"QueryCompositeFilterConstraint",()=>uJ,"QueryConstraint",()=>u$,"QueryDocumentSnapshot",()=>hy,"QueryEndAtConstraint",()=>u4,"QueryFieldFilterConstraint",()=>uH,"QueryLimitConstraint",()=>u1,"QueryOrderByConstraint",()=>uZ,"QuerySnapshot",()=>hw,"QueryStartAtConstraint",()=>u6,"SnapshotMetadata",()=>hg,"Timestamp",()=>ev,"Transaction",()=>h1,"VectorValue",()=>ug,"WriteBatch",()=>hY,"_AutoId",()=>Y,"_ByteString",()=>t8,"_DatabaseId",()=>nh,"_DocumentKey",()=>el,"_EmptyAppCheckTokenProvider",()=>X,"_EmptyAuthCredentialsProvider",()=>G,"_FieldPath",()=>eo,"_TestingHooks",()=>cc,"_cast",()=>em,"_debugAssert",()=>U,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>ch,"_internalQueryToProtoQueryTarget",()=>cu,"_isBase64Available",()=>t3,"_logWarn",()=>O,"_validateIsNotUsedTogether",()=>eh,"addDoc",()=>hk,"aggregateFieldEqual",()=>hc,"aggregateQuerySnapshotEqual",()=>hd,"and",()=>uY,"arrayRemove",()=>h8,"arrayUnion",()=>h3,"average",()=>hu,"clearIndexedDbPersistence",()=>ue,"collection",()=>l$,"collectionGroup",()=>lQ,"connectFirestoreEmulator",()=>lj,"count",()=>hh,"deleteAllPersistentCacheIndexes",()=>ca,"deleteDoc",()=>hN,"deleteField",()=>h5,"disableNetwork",()=>ur,"disablePersistentCacheIndexAutoCreation",()=>cs,"doc",()=>lH,"documentId",()=>uc,"documentSnapshotFromJSON",()=>hp,"enableIndexedDbPersistence",()=>l4,"enableMultiTabIndexedDbPersistence",()=>l7,"enableNetwork",()=>un,"enablePersistentCacheIndexAutoCreation",()=>ci,"endAt",()=>u9,"endBefore",()=>u7,"ensureFirestoreConfigured",()=>l3,"executeWrite",()=>hP,"getAggregateFromServer",()=>hV,"getCountFromServer",()=>hF,"getDoc",()=>hI,"getDocFromCache",()=>hE,"getDocFromServer",()=>h_,"getDocs",()=>hS,"getDocsFromCache",()=>hx,"getDocsFromServer",()=>hA,"getFirestore",()=>l6,"getPersistentCacheIndexManager",()=>cr,"increment",()=>h4,"initializeFirestore",()=>l5,"limit",()=>u2,"limitToLast",()=>u5,"loadBundle",()=>us,"memoryEagerGarbageCollector",()=>hz,"memoryLocalCache",()=>hK,"memoryLruGarbageCollector",()=>hG,"namedQuery",()=>ua,"onSnapshot",()=>hR,"onSnapshotResume",()=>hM,"onSnapshotsInSync",()=>hO,"or",()=>uX,"orderBy",()=>u0,"persistentLocalCache",()=>h$,"persistentMultipleTabManager",()=>hJ,"persistentSingleTabManager",()=>hW,"query",()=>uQ,"queryEqual",()=>lJ,"querySnapshotFromJSON",()=>hv,"refEqual",()=>lW,"runTransaction",()=>h2,"serverTimestamp",()=>h6,"setDoc",()=>hC,"setIndexConfiguration",()=>ce,"setLogLevel",()=>k,"snapshotEqual",()=>hb,"startAfter",()=>u8,"startAt",()=>u3,"sum",()=>hl,"terminate",()=>ui,"updateDoc",()=>hD,"vector",()=>h7,"waitForPendingWrites",()=>ut,"where",()=>uW,"writeBatch",()=>h9],98925),e.s([],36180)}]);